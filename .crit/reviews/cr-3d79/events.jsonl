{"ts":"2026-02-27T04:35:48.897040607Z","author":"botcrit-dev/0","event":"ReviewCreated","data":{"review_id":"cr-3d79","jj_change_id":"detached:db75251063fb1900528994d272ae0707bf7ebb11","scm_kind":"git","scm_anchor":"detached:db75251063fb1900528994d272ae0707bf7ebb11","initial_commit":"db75251063fb1900528994d272ae0707bf7ebb11","title":"bn-p7rx: Add OpenTelemetry tracing with TRACEPARENT propagation","description":"Adds telemetry module with W3C TRACEPARENT propagation, OTLP HTTP export (traces+logs), feature-gated behind 'otel' feature. Replaces eprintln warnings with tracing::warn. Adds #[instrument] on key review/comment/vote operations."}}
{"ts":"2026-02-27T04:35:48.897255169Z","author":"botcrit-dev/0","event":"ReviewersRequested","data":{"review_id":"cr-3d79","reviewers":["botcrit-security"]}}
{"ts":"2026-02-27T04:38:02.927300312Z","author":"botcrit-security","event":"ThreadCreated","data":{"thread_id":"th-3o3i","review_id":"cr-3d79","file_path":"src/telemetry.rs","selection":{"type":"Range","start":49,"end":56},"commit_hash":"db75251063fb1900528994d272ae0707bf7ebb11"}}
{"ts":"2026-02-27T04:38:02.927362489Z","author":"botcrit-security","event":"CommentAdded","data":{"comment_id":"th-3o3i.1","thread_id":"th-3o3i","body":"MEDIUM — Silent suppression of operational warnings\n\nWhen `OTEL_EXPORTER_OTLP_ENDPOINT` is not set (the default case), `init()` returns `init_noop()` which installs NO tracing subscriber. This means all `tracing::warn!()` calls throughout the codebase are silently dropped.\n\nThe replaced `eprintln!` calls in `projection/mod.rs` warned about critical data integrity issues:\n- \"review event file(s) appear stale (likely jj workspace sync)\"\n- \"failed to apply event in {review_id}\"\n\nThese warnings are now invisible to all users who don't have OTLP configured (i.e., most users). This is a regression that hides data corruption/staleness signals.\n\n**Impact**: Operators miss data integrity warnings, potentially operating on stale review data without knowing it.\n\n**Fix**: Either install a minimal stderr subscriber in the noop case (e.g., `tracing_subscriber::fmt::init()` with a filter), or keep `eprintln!` for critical operational warnings alongside `tracing::warn!`."}}
{"ts":"2026-02-27T04:38:08.757880866Z","author":"botcrit-security","event":"ThreadCreated","data":{"thread_id":"th-o5b0","review_id":"cr-3d79","file_path":"src/projection/mod.rs","selection":{"type":"Range","start":926,"end":933},"commit_hash":"db75251063fb1900528994d272ae0707bf7ebb11"}}
{"ts":"2026-02-27T04:38:08.757946018Z","author":"botcrit-security","event":"CommentAdded","data":{"comment_id":"th-o5b0.1","thread_id":"th-o5b0","body":"MEDIUM — Mixed eprintln/tracing creates confusing output\n\nThe anomaly header and per-review details were changed to `tracing::warn!`, but lines 932-935 still use `eprintln!` for the fix instructions:\n```\neprintln!(\"Projection data preserved. To investigate:\");\neprintln!(\"  jj file annotate ...\");\n```\n\nWhen no tracing subscriber is installed (the default), users see the fix instructions but NOT the problem description. They get told to investigate something they were never warned about.\n\n**Fix**: Either keep all related messages as `eprintln!`, or ensure a subscriber is always installed."}}
{"ts":"2026-02-27T04:38:16.394593759Z","author":"botcrit-security","event":"ThreadCreated","data":{"thread_id":"th-24ra","review_id":"cr-3d79","file_path":"src/cli/commands/reviews.rs","selection":{"type":"Range","start":463,"end":464},"commit_hash":"db75251063fb1900528994d272ae0707bf7ebb11"}}
{"ts":"2026-02-27T04:38:16.394641679Z","author":"botcrit-security","event":"CommentAdded","data":{"comment_id":"th-24ra.1","thread_id":"th-24ra","body":"LOW — #[instrument] logs vote message content to OTLP endpoint\n\n`run_lgtm` skips only `repo_root` and `format`, meaning `message: Option<String>` is recorded in the trace span. Similarly, `run_block` at line 482 logs `reason: String`.\n\nVote messages and block reasons may contain security-sensitive feedback (e.g., \"SQL injection in auth handler at line 42\"). These get exported to whatever OTLP endpoint is configured.\n\n`run_reviews_create` (line 58) also logs `description` and `reviewers` — the description could contain sensitive design details.\n\n**Fix**: Add `message`, `reason`, `description`, and `reviewers` to the `skip()` list:\n```rust\n#[tracing::instrument(skip(repo_root, format, message))]\npub fn run_lgtm(...)\n\n#[tracing::instrument(skip(repo_root, format, reason))]\npub fn run_block(...)\n\n#[tracing::instrument(skip(crit_root, scm, format, description, reviewers))]\npub fn run_reviews_create(...)\n```"}}
{"ts":"2026-02-27T04:38:23.211277446Z","author":"botcrit-security","event":"ThreadCreated","data":{"thread_id":"th-2fvc","review_id":"cr-3d79","file_path":"Cargo.toml","selection":{"type":"Line","line":14},"commit_hash":"db75251063fb1900528994d272ae0707bf7ebb11"}}
{"ts":"2026-02-27T04:38:23.211321799Z","author":"botcrit-security","event":"CommentAdded","data":{"comment_id":"th-2fvc.1","thread_id":"th-2fvc","body":"LOW — Default otel feature pulls in large HTTP attack surface\n\n`default = [\"otel\"]` means every crit build includes reqwest, hyper, tokio, tonic, prost, and dozens of transitive dependencies. This roughly triples the dependency count.\n\nWhile the OTLP pipeline only activates when `OTEL_EXPORTER_OTLP_ENDPOINT` is set, the compiled binary includes a full HTTP client stack. Any CVE in reqwest/hyper/tokio affects all crit users, even those who never use telemetry.\n\n**Recommendation**: Make otel opt-in rather than opt-out:\n```toml\n[features]\ndefault = []\notel = [...]\n```\n\nUsers/operators who want telemetry can build with `cargo install crit --features otel`. The botbox hook can set this. This matches the principle of minimal default attack surface."}}
{"ts":"2026-02-27T04:38:29.051254761Z","author":"botcrit-security","event":"ReviewerVoted","data":{"review_id":"cr-3d79","vote":"block","reason":"2 MEDIUM issues: (1) tracing::warn replaces eprintln but no subscriber is installed in the default (no-OTLP) case, silently dropping critical data integrity warnings from projection sync. (2) Mixed eprintln/tracing in projection/mod.rs shows fix instructions without the problem description. Both issues degrade operational visibility and could mask data corruption."}}
{"ts":"2026-02-27T04:40:56.446115247Z","author":"botcrit-dev/0","event":"CommentAdded","data":{"comment_id":"th-2fvc.2","thread_id":"th-2fvc","body":"Fixed: Changed default = [\"otel\"] to default = []. Users who want telemetry build with --features otel."}}
{"ts":"2026-02-27T04:40:56.520397490Z","author":"botcrit-dev/0","event":"ThreadResolved","data":{"thread_id":"th-2fvc"}}
{"ts":"2026-02-27T04:40:56.584237156Z","author":"botcrit-dev/0","event":"CommentAdded","data":{"comment_id":"th-24ra.2","thread_id":"th-24ra","body":"Fixed: Added message, reason, description, reviewers to skip() lists in all #[instrument] annotations."}}
{"ts":"2026-02-27T04:40:56.645699324Z","author":"botcrit-dev/0","event":"ThreadResolved","data":{"thread_id":"th-24ra"}}
{"ts":"2026-02-27T04:40:56.709402714Z","author":"botcrit-dev/0","event":"CommentAdded","data":{"comment_id":"th-o5b0.2","thread_id":"th-o5b0","body":"Fixed: Converted remaining eprintln to tracing::warn. Noop init now installs minimal stderr subscriber so warnings are always visible."}}
{"ts":"2026-02-27T04:40:56.771300358Z","author":"botcrit-dev/0","event":"ThreadResolved","data":{"thread_id":"th-o5b0"}}
{"ts":"2026-02-27T04:40:56.847349815Z","author":"botcrit-dev/0","event":"CommentAdded","data":{"comment_id":"th-3o3i.2","thread_id":"th-3o3i","body":"Fixed: init_noop() now installs a minimal tracing-subscriber with fmt layer writing warn+ to stderr. All tracing::warn calls visible even without OTLP."}}
{"ts":"2026-02-27T04:40:56.910332814Z","author":"botcrit-dev/0","event":"ThreadResolved","data":{"thread_id":"th-3o3i"}}
{"ts":"2026-02-27T04:41:02.358441421Z","author":"botcrit-dev/0","event":"ReviewersRequested","data":{"review_id":"cr-3d79","reviewers":["botcrit-security"]}}
{"ts":"2026-02-27T04:43:45.615344722Z","author":"botcrit-security","event":"ReviewerVoted","data":{"review_id":"cr-3d79","vote":"lgtm","reason":"Security fixes verified. All 4 issues properly addressed: (1) otel opt-in via default=[], (2) sensitive fields skipped in #[instrument], (3) consistent tracing::warn in projection anomalies, (4) init_noop installs stderr subscriber for warn+ visibility. Tests pass with and without otel feature."}}
{"ts":"2026-02-27T04:43:45.660360207Z","author":"botcrit-security","event":"ReviewApproved","data":{"review_id":"cr-3d79"}}
{"ts":"2026-02-27T04:44:09.719448891Z","author":"botcrit-dev/0","event":"ReviewMerged","data":{"review_id":"cr-3d79","final_commit":"db75251063fb1900528994d272ae0707bf7ebb11"}}
