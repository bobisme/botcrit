{"ts":"2026-02-05T17:54:27.070098369Z","author":"botcrit-dev","event":"ReviewCreated","data":{"review_id":"cr-1s0w","jj_change_id":"wnlmyunxyvmxpznumqnslkwuvnvvptvk","initial_commit":"ad1894e0d665e1bd4bbca6685cbfeb284a0372fc","title":"bd-2r8: Fix v1→v2 migration dropping thread-linked events","description":"Fixes bug where CommentAdded, ThreadResolved, and ThreadReopened events were silently dropped during v1→v2 migration because extract_review_id returned None for them. Adds --from-backup flag for recovery."}}
{"ts":"2026-02-05T17:54:31.787880764Z","author":"botcrit-dev","event":"ReviewersRequested","data":{"review_id":"cr-1s0w","reviewers":["botcrit-security"]}}
{"ts":"2026-02-05T17:57:31.069509600Z","author":"botcrit-security","event":"ThreadCreated","data":{"thread_id":"th-2n4m","review_id":"cr-1s0w","file_path":"src/cli/commands/migrate.rs","selection":{"type":"Range","start":311,"end":312},"commit_hash":"98a817eb6d356d651d67afdaeb6f30af57404fbf"}}
{"ts":"2026-02-05T17:57:31.069574402Z","author":"botcrit-security","event":"CommentAdded","data":{"comment_id":"th-2n4m.1","thread_id":"th-2n4m","body":"HIGH: Path traversal via crafted review_id in backup file.\n\nrun_remigrate_from_backup reads events from events.jsonl.v1.backup (line 269-272), extracts review_id values via resolve_review_id, and passes them directly to open_or_create_review (line 312) without validating the format. open_or_create_review constructs a filesystem path by joining the review_id to .crit/reviews/ — a malicious backup file could contain review_id values like '../../../tmp/evil' which would create directories and write files outside the .crit/reviews/ tree.\n\nThis is a new attack surface introduced by --from-backup: it reads from a file that may have been tampered with (or restored from an untrusted source) and uses unsanitized IDs to create directories and write data.\n\nMitigation: Validate review_id format (e.g., call is_review_id()) before passing to open_or_create_review, both in the remigrate path (line 312) and the main migration path (line 186)."}}
{"ts":"2026-02-05T17:57:39.898093299Z","author":"botcrit-security","event":"ThreadCreated","data":{"thread_id":"th-2b8k","review_id":"cr-1s0w","file_path":"src/cli/commands/migrate.rs","selection":{"type":"Range","start":316,"end":318},"commit_hash":"fd9ef22ae9c521cb4124f2efa8869d3c758333b5"}}
{"ts":"2026-02-05T17:57:39.898158481Z","author":"botcrit-security","event":"CommentAdded","data":{"comment_id":"th-2b8k.1","thread_id":"th-2b8k","body":"MEDIUM: Dedup key collision could allow event injection during re-migration.\n\nThe dedup logic uses timestamp + discriminant as the key:\n  format!('{}:{:?}', e.ts.to_rfc3339(), std::mem::discriminant(&e.event))\n\nTwo events of the same type with the same timestamp (sub-second granularity of rfc3339 varies by implementation) would collide, causing a legitimate backup event to be silently dropped. Conversely, a crafted backup with manipulated timestamps could inject duplicate events that bypass dedup.\n\nThis is lower severity since the attack requires write access to the backup file, but worth noting: the dedup key should include more event-specific fields (e.g., comment_id, thread_id) to be robust."}}
{"ts":"2026-02-05T17:57:48.384974014Z","author":"botcrit-security","event":"ThreadCreated","data":{"thread_id":"th-3r20","review_id":"cr-1s0w","file_path":"src/cli/commands/migrate.rs","selection":{"type":"Range","start":139,"end":143},"commit_hash":"8ff2fd4064facf28c57ef101cc435b7b925eb5dc"}}
{"ts":"2026-02-05T17:57:48.385034878Z","author":"botcrit-security","event":"CommentAdded","data":{"comment_id":"th-3r20.1","thread_id":"th-3r20","body":"LOW: Orphan event details leaked to stderr may expose internal data.\n\nThe eprintln! on line 140-143 prints {:?} of the full event, which includes all fields (review_id, thread_id, comment bodies, etc.). If events contain sensitive content (e.g., security-review comments), this could leak to stderr in logs or terminal scrollback. Consider logging only the event type and timestamp, not the full Debug output."}}
{"ts":"2026-02-05T17:57:53.426609284Z","author":"botcrit-security","event":"ReviewerVoted","data":{"review_id":"cr-1s0w","vote":"block","reason":"HIGH: Path traversal via unsanitized review_id in --from-backup path. Malicious backup files can write outside .crit/reviews/ via crafted review_id values (e.g., '../../../tmp/evil'). Must validate review_id format before passing to open_or_create_review. Also MEDIUM: dedup key collision weakness in re-migration. See threads for details."}}
{"ts":"2026-02-05T18:02:27.701545706Z","author":"botcrit-dev","event":"CommentAdded","data":{"comment_id":"th-2n4m.2","thread_id":"th-2n4m","body":"Fixed. Added is_review_id() validation before open_or_create_review in both the main migration path and the --from-backup path. Invalid review_ids (anything not matching cr-XXXX format) now cause an early bail! with a descriptive error. Added regression test test_migrate_rejects_path_traversal_review_id that verifies ../../../tmp/evil is rejected."}}
{"ts":"2026-02-05T18:02:30.058828306Z","author":"botcrit-dev","event":"CommentAdded","data":{"comment_id":"th-2b8k.2","thread_id":"th-2b8k","body":"Fixed. Replaced the timestamp+discriminant dedup key with event_dedup_key() which includes event-specific IDs (comment_id for CommentAdded, thread_id for ThreadCreated/Resolved/Reopened, review_id+author for ReviewerVoted, etc.). This makes collisions between same-type events with identical timestamps impossible."}}
{"ts":"2026-02-05T18:02:31.428425111Z","author":"botcrit-dev","event":"CommentAdded","data":{"comment_id":"th-3r20.2","thread_id":"th-3r20","body":"Fixed. Replaced {:?} debug output with event_type_label() which returns only the event type name (e.g. \"CommentAdded\") plus the timestamp. No comment bodies, thread IDs, or other sensitive content is leaked to stderr."}}
{"ts":"2026-02-05T18:02:34.685403502Z","author":"botcrit-dev","event":"ReviewersRequested","data":{"review_id":"cr-1s0w","reviewers":["botcrit-security"]}}
{"ts":"2026-02-05T18:03:41.604712164Z","author":"botcrit-security","event":"CommentAdded","data":{"comment_id":"th-2n4m.3","thread_id":"th-2n4m","body":"Verified. is_review_id() validation now gates open_or_create_review in both the main migration path (line 226) and --from-backup path (line 360). The terseid parser correctly rejects path traversal payloads like '../../../tmp/evil'. Regression test confirms. Resolved."}}
{"ts":"2026-02-05T18:03:42.746443170Z","author":"botcrit-security","event":"CommentAdded","data":{"comment_id":"th-2b8k.3","thread_id":"th-2b8k","body":"Verified. event_dedup_key() now includes event-specific IDs (comment_id, thread_id, review_id+author) alongside timestamp and discriminant. Same-type same-timestamp collisions are no longer possible. Resolved."}}
{"ts":"2026-02-05T18:03:44.277890430Z","author":"botcrit-security","event":"CommentAdded","data":{"comment_id":"th-3r20.3","thread_id":"th-3r20","body":"Verified. event_type_label() returns only a static &str label — no sensitive event data is exposed to stderr. Resolved."}}
{"ts":"2026-02-05T18:03:49.196386363Z","author":"botcrit-security","event":"ThreadResolved","data":{"thread_id":"th-2n4m","reason":"Path traversal fix verified with is_review_id() validation and regression test"}}
{"ts":"2026-02-05T18:03:49.931942424Z","author":"botcrit-security","event":"ThreadResolved","data":{"thread_id":"th-2b8k","reason":"Dedup key collision fix verified with event-specific IDs"}}
{"ts":"2026-02-05T18:03:50.818528095Z","author":"botcrit-security","event":"ThreadResolved","data":{"thread_id":"th-3r20","reason":"Info disclosure fix verified — only static type labels logged"}}
{"ts":"2026-02-05T18:03:55.714747612Z","author":"botcrit-security","event":"ReviewerVoted","data":{"review_id":"cr-1s0w","vote":"lgtm","reason":"All 3 security findings addressed: (1) HIGH path traversal — is_review_id() validation added in both migration paths with regression test, (2) MEDIUM dedup collision — event_dedup_key() now uses event-specific IDs, (3) LOW info disclosure — event_type_label() returns only static type names. All 8 migration tests pass."}}
{"ts":"2026-02-05T18:03:55.723677931Z","author":"botcrit-security","event":"ReviewApproved","data":{"review_id":"cr-1s0w"}}
{"ts":"2026-02-05T18:04:21.305981299Z","author":"botcrit-dev","event":"ReviewMerged","data":{"review_id":"cr-1s0w","final_commit":"f5430ab4493a7b3011eb6952b5530239a24164d0"}}
