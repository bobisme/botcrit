{"id":"bd-10f","title":"Update generate-demo.sh to showcase multi-workspace reviews","description":"## Context\nThe `--all-workspaces` feature (bd-3un) was just landed. The demo script should be updated to showcase this capability.\n\n## Changes Needed\n1. Create multiple jj workspaces in the demo\n2. Create reviews in different workspaces\n3. Show `crit reviews list --all-workspaces` grouping reviews by workspace\n4. Show `crit inbox --all-workspaces` with workspace annotations\n\n## Current Demo Location\n`scripts/generate-demo.sh` or `docs/demo.md`\n\n## Example Output to Demonstrate\n```\n=== default (.) ===\n  cr-abc · Fix bug by alice [open]\n\n=== feature-x (.workspaces/feature-x) ===\n  cr-def · Add endpoint by bob [approved]\n\n=== (no active workspace) ===\n  cr-ghi · Old refactor by charlie [merged]\n```","status":"closed","priority":3,"issue_type":"task","owner":"botcrit-dev","created_at":"2026-02-04T23:24:39.924122982Z","created_by":"botcrit-dev","updated_at":"2026-02-04T23:31:41.346340068Z","closed_at":"2026-02-04T23:31:41.346301756Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-124","title":"Implement AppendLog with file locking","description":"Create AppendLog trait and FileLog implementation. Use fs2 crate for advisory file locks. Support atomic appends from multiple concurrent agents. Handle lock contention gracefully.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-25T04:03:51.953122137Z","created_by":"bob","updated_at":"2026-01-25T13:42:00.539414630Z","closed_at":"2026-01-25T13:42:00.539401355Z","close_reason":"Implemented with tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-124","depends_on_id":"bd-jc0","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-12q","title":"(resolved) Research: TOON format implementation","description":"RESOLVED: toon-rust crate exists at https://github.com/toon-format/toon-rust - use that.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-25T04:04:35.609073517Z","created_by":"bob","updated_at":"2026-01-25T13:42:14.011403475Z","closed_at":"2026-01-25T13:42:14.011386823Z","close_reason":"Implemented","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-12q","depends_on_id":"bd-2sw","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-13r","title":"Schema migration bug: next_comment_number column missing during rebuild","description":"When rebuilding the reviews.db from events.jsonl, the CommentAdded event handler fails with:\n\n```\nError: no such column: next_comment_number in UPDATE threads SET next_comment_number = next_comment_number + 1 WHERE thread_id = ?\n```\n\nThis occurs during `crit reviews list` or any operation that triggers a projection rebuild.\n\nReproduction:\n1. Have an events.jsonl with ThreadCreated followed by CommentAdded events\n2. Delete reviews.db\n3. Run any crit command that rebuilds the projection\n\nThe schema migration seems to be missing the next_comment_number column in the threads table, or the migration isn't running before the event replay.\n\nImpact: Blocks review operations entirely when the database needs to be rebuilt from events.\n\nWorkaround: Manually truncate events.jsonl to remove the problematic events (losing review history).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-04T04:45:03.955079965Z","created_by":"maw-dev","updated_at":"2026-02-04T05:02:33.879672353Z","closed_at":"2026-02-04T05:02:33.879642878Z","close_reason":"Completed - migration added, test included, security reviewed","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":14,"issue_id":"bd-13r","author":"botcrit-dev","text":"Started in workspace wise-castle (/home/bob/src/botcrit/.workspaces/wise-castle)","created_at":"2026-02-04T04:45:32Z"},{"id":15,"issue_id":"bd-13r","author":"botcrit-dev","text":"Re-implemented fix after workspace merge conflict issues. Original review cr-3q1i was approved by security but workspace merge had conflicts. Clean reimplementation complete with test.","created_at":"2026-02-04T04:59:49Z"},{"id":16,"issue_id":"bd-13r","author":"botcrit-dev","text":"Review requested: cr-p8ye","created_at":"2026-02-04T04:59:57Z"}]}
{"id":"bd-13u","title":"Feature: allow creating comments without explicit thread creation","description":"Currently agents must:\n1. crit threads create <review> --file <file> --lines <lines>\n2. crit comments add <thread_id> <message>\n\nThis is confusing - agents expect to just leave a comment on a line.\n\nIMPLEMENTATION (Option 1 - Auto-create thread):\nAdd new command: crit comment <review> --file <file> --line <line> <message>\n- If no thread exists at that location, create one automatically\n- If thread exists at same file+line, add comment to existing thread\n- Single command instead of two\n\nThis is a breaking change in UX (new preferred workflow), so bump to v0.2.0.\n\nSubtasks:\n- Add 'crit comment' command (alias for combined thread+comment)\n- Auto-detect existing thread at same file+line\n- Update help text and examples\n- Update AGENTS.md instructions","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-26T20:15:55.821869630Z","created_by":"bob","updated_at":"2026-01-26T20:54:55.971030139Z","closed_at":"2026-01-26T20:54:55.970980166Z","close_reason":"Implemented: crit comment command with auto-thread creation","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-141","title":"Move events.jsonl to external storage to prevent jj-induced data loss","description":"## Problem\n\nevents.jsonl lives in the jj-tracked working tree (.crit/events.jsonl). When jj performs working copy operations (squash, rebase, workspace merge), it can replace the file with an older version. This causes reviews to be lost.\n\nCurrent mitigations (truncation detection, content hash, orphan backup) only DETECT the loss - they don't PREVENT it. Reviews are still lost, they're just not silently lost anymore.\n\nEvidence: Last night (2026-02-04), review cr-3q1i was lost during workspace merge despite being approved by security. Had to be recreated as cr-p8ye.\n\n## Root Cause\n\nArchitectural mismatch:\n- events.jsonl is mutable append-only runtime state\n- jj treats it as source code and overwrites it during working copy updates\n- crit's file locking (fs2 advisory locks) only protects against concurrent crit processes, not jj operations\n\n## Proposed Solution\n\nMove events.jsonl to external storage outside the jj-tracked tree:\n\n**Location:** ~/.local/share/crit/<repo-id>/events.jsonl\n\nWhere <repo-id> is a stable identifier for the repository (e.g., hash of canonical repo path or jj repo UUID).\n\n**Benefits:**\n- Survives ALL jj operations (squash, rebase, restore, workspace merge)\n- Shared across all workspaces (same as current behavior)\n- No namespace squatting in .jj/\n- Standard XDG data directory convention\n\n**Migration path:**\n1. On startup, check if old .crit/events.jsonl exists\n2. If external location is empty, migrate from .crit/\n3. Add .crit/events.jsonl to .gitignore (or remove entirely)\n4. Keep index.db in .crit/ (already gitignored, workspace-local is fine)\n\n## Implementation Tasks\n\n1. Add repo-id generation (hash of jj repo UUID or canonical path)\n2. Add external storage path resolution (~/.local/share/crit/<repo-id>/)\n3. Migrate FileLog to use external path\n4. Add migration logic for existing repos\n5. Update crit init to create external directory\n6. Update crit doctor to check external storage health\n7. Document the new architecture\n\n## Acceptance Criteria\n\n- events.jsonl is stored outside jj-tracked tree\n- jj workspace operations cannot corrupt/truncate events\n- Existing repos migrate seamlessly on first use\n- All workspaces share the same events.jsonl (no divergence)\n- crit doctor validates external storage is accessible\n\n## References\n\n- bd-oum: Original design discussion (Option B)\n- bd-2m6: Detection/recovery implementation (closed, but doesn't fix root cause)\n- bd-1cl (maw): Downstream issue blocked on this fix\n- src/log/mod.rs: FileLog implementation\n- src/projection/mod.rs: sync_from_log_with_backup","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-04T15:01:38.662801231Z","created_by":"bob","updated_at":"2026-02-04T15:04:22.358148536Z","closed_at":"2026-02-04T15:04:22.358117027Z","close_reason":"Won't fix: reviews must be checked in with the project. Current detection/recovery mechanisms (truncation detection, content hash, orphan backup) are the correct solution for this constraint.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-144","title":"Implement projection sync","description":"Read events.jsonl and apply to SQLite. Track last processed line for incremental sync. Handle full rebuild when DB is missing/corrupted.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-25T04:04:06.870800492Z","created_by":"bob","updated_at":"2026-01-25T13:50:33.656966806Z","closed_at":"2026-01-25T13:50:33.656948231Z","close_reason":"Implemented with full sync and event application","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-144","depends_on_id":"bd-26n","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-144","depends_on_id":"bd-3h7","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-144","depends_on_id":"bd-w6q","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-146","title":"Add crit migrate command for v1->v2 data migration","description":"Explicit migration tool to convert from single events.jsonl to per-review structure.\n\n## Migration steps\n1. Read all events from .crit/events.jsonl\n2. Group by review_id\n3. Create .crit/reviews/{review_id}/ directories\n4. Write events to per-review events.jsonl files (preserving order by timestamp)\n5. Create .crit/version file with \"2\"\n6. Optionally: rename old events.jsonl to events.jsonl.v1.backup\n\n## CLI\n```\ncrit migrate [--dry-run] [--backup]\n```\n\n- --dry-run: Show what would be migrated without writing\n- --backup: Keep old events.jsonl as .backup (default: true)\n\n## Edge cases\n- Empty events.jsonl\n- Corrupt events (skip with warning? fail?)\n- Already migrated (version file exists)\n- Partial migration (crashed mid-way) - should be idempotent\n\n## Testing\n- Fresh repo with events → migrated structure\n- Empty repo → just creates version file\n- Already migrated → no-op with message\n- Corrupt event line → graceful handling","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-04T15:38:53.581029313Z","created_by":"bob","updated_at":"2026-02-04T17:19:32.562538278Z","closed_at":"2026-02-04T17:19:32.562490237Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-146","depends_on_id":"bd-15h","type":"blocks","created_at":"2026-02-04T15:39:08.182935055Z","created_by":"bob","metadata":"{}","thread_id":""},{"issue_id":"bd-146","depends_on_id":"bd-3a4","type":"blocks","created_at":"2026-02-04T15:39:08.116418217Z","created_by":"bob","metadata":"{}","thread_id":""}],"comments":[{"id":19,"issue_id":"bd-146","author":"Bob","text":"Implemented: crit migrate command with --dry-run and --backup flags. Groups events by review_id. Full test coverage.","created_at":"2026-02-04T15:47:48Z"}]}
{"id":"bd-14d","title":"Include --agent flag in all next-step command examples","description":"Agent sandboxes don't persist env vars, so CRIT_AGENT/BOTBUS_AGENT won't be available. Update all next-step output to include --agent flag in example commands.\n\nFiles to update:\n- src/cli/commands/init.rs: crit reviews create example\n- src/cli/commands/reviews.rs: reviews create next steps\n- Any other places that show example crit commands\n\nPattern: crit --agent <name> <command> instead of just crit <command>","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T02:39:50.896244908Z","created_by":"bob","updated_at":"2026-01-31T02:42:55.046300704Z","closed_at":"2026-01-31T02:42:55.046277751Z","close_reason":"Updated all output to include --agent flag","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-14f","title":"Remove redundant selection glyph from TUI lists","description":"The triangular glyph takes up space but is redundant since we highlight the selected line.","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-25T21:58:57.999294400Z","created_by":"bob","updated_at":"2026-01-25T22:03:09.373465258Z","closed_at":"2026-01-25T22:03:09.373434300Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-15h","title":"Update projection to scan per-review event logs","description":"Modify projection sync to read from reviews/*/events.jsonl instead of single file.\n\n## Changes\n- Scan .crit/reviews/ for all review directories\n- Read events.jsonl from each\n- Maintain per-review sync state (last line per review, or timestamp-based)\n- Rebuild scans all review logs\n\n## Sync strategy options\n1. Per-review line tracking in sync_state table\n2. Timestamp-based (replay events newer than last_sync_ts)\n3. Full rebuild on any change (simple but slow for large repos)\n\nRecommend option 1 for efficiency.\n\n## Files to modify\n- src/projection/mod.rs: sync_from_log, rebuild functions\n- Schema: sync_state table needs review_id column or new table\n\n## Testing\n- Sync from empty state\n- Incremental sync with new events in one review\n- Incremental sync with new events in multiple reviews\n- Rebuild from scratch\n- Handle missing/corrupt single review gracefully","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-04T15:38:37.309132883Z","created_by":"bob","updated_at":"2026-02-04T17:19:32.015363883Z","closed_at":"2026-02-04T17:19:32.015333206Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-15h","depends_on_id":"bd-3a4","type":"blocks","created_at":"2026-02-04T15:39:08.052707518Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-15o","title":"Review diff should show all changed files from parent, not just since creation","description":"Currently reviews use changed_files_between(initial_commit, target) which shows only files that changed AFTER the review was created. For fresh reviews, this shows nothing.\n\nShould use: changed_files_between(parent_of_initial, target) to show ALL files in the change being reviewed.\n\nAffects: TUI file list, crit diff command","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-25T23:16:56.854850224Z","created_by":"bob","updated_at":"2026-01-26T19:25:09.779161703Z","closed_at":"2026-01-26T19:25:09.779139221Z","close_reason":"Fixed: diff now uses parent(initial_commit) as base to show all changed files","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-168","title":"Query API for reviews/threads/comments","description":"Implement query functions: list_reviews(), get_review(), list_threads(), get_thread(), list_comments(). Support filtering by status, author, file path.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T04:04:08.450310672Z","created_by":"bob","updated_at":"2026-01-25T14:19:41.705567008Z","closed_at":"2026-01-25T14:19:41.705548884Z","close_reason":"Implemented query API with 23 tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-168","depends_on_id":"bd-144","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-168","depends_on_id":"bd-26n","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-16n","title":"Auto-resolve threads when review is merged","description":"When a review is merged, threads that were never explicitly resolved still show as `status: open`. This causes merged reviews to display misleading unresolved thread counts (e.g., \"5/5 threads\").\n\n## Current Behavior\n- Threads created during review stay `status: open` forever unless explicitly resolved\n- Merged reviews show open thread counts even though the review is complete\n- Example: cr-hdox in botty repo shows 5/5 open threads despite being merged\n\n## Expected Behavior\nWhen a review is merged, one of:\n1. Auto-resolve all open threads (add ThreadResolved events with reason \"review_merged\")\n2. Add a virtual/computed status that treats threads on merged reviews as resolved\n3. Return a different status like \"stale\" or \"merged\" for threads on merged reviews\n\n## Impact\n- crit-ui shows confusing unresolved thread counts on old merged reviews\n- Users may think there are outstanding issues on completed reviews\n\n## Events from cr-hdox showing the issue\n```\nThreadCreated (th-pa12)\nThreadCreated (th-9bvu)  \nThreadCreated (th-oysl)\nThreadCreated (th-za40)\nThreadCreated (th-eoie)\nReviewApproved\nReviewMerged\n# No ThreadResolved events!\n```","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-02-04T22:20:46.167847230Z","created_by":"bob","updated_at":"2026-02-04T22:53:05.073072574Z","closed_at":"2026-02-04T22:53:05.073043330Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":20,"issue_id":"bd-16n","author":"botcrit-dev","text":"Started in workspace calm-panther (/home/bob/src/botcrit/.workspaces/calm-panther)","created_at":"2026-02-04T22:26:52Z"},{"id":22,"issue_id":"bd-16n","author":"botcrit-dev","text":"Review cr-362m created and requested from @botcrit-security","created_at":"2026-02-04T22:37:55Z"}]}
{"id":"bd-18s","title":"crit reviews subcommands","description":"Implement reviews create, list, show, request, approve, abandon. Wire up to event log and projection queries.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T04:04:42.399891452Z","created_by":"bob","updated_at":"2026-01-25T16:51:04.174298384Z","closed_at":"2026-01-25T16:51:04.174274369Z","close_reason":"Implemented reviews create/list/show/request/approve/abandon with TOON and JSON output","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-18s","depends_on_id":"bd-168","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-18s","depends_on_id":"bd-1sj","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-18s","depends_on_id":"bd-21c","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-18s","depends_on_id":"bd-2sw","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-18s","depends_on_id":"bd-351","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-18s","depends_on_id":"bd-hk6","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1ci","title":"crit doctor should check that index.db is gitignored","description":"crit doctor should verify that .crit/index.db (the ephemeral SQLite projection) is in .gitignore. The database is rebuildable from events.jsonl and should not be committed. If not gitignored, doctor should warn.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T21:25:10.617370308Z","created_by":"bob","updated_at":"2026-01-28T22:20:12.363204983Z","closed_at":"2026-01-28T22:20:12.363185627Z","close_reason":"Added check_index_gitignored to crit doctor. Uses git check-ignore to warn if .crit/index.db isn't in .gitignore, with remediation hint.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1ck","title":"crit reviews create: add --workspace flag","description":"Add --workspace <path> flag to crit reviews create that stores the workspace absolute path in review metadata (the existing workspace: null field). Reviewers need this to know where to read source files — the diff shows relative paths but the actual files live in .workspaces/$WS/, not the project root. This was the #1 friction point in multi-agent run 1 (botbox): the reviewer read from project root 4+ times before finding the workspace path buried in bead comments.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-02T00:45:15.021861275Z","created_by":"bob","updated_at":"2026-02-02T00:54:48.831482464Z","closed_at":"2026-02-02T00:54:48.831453139Z","close_reason":"Solved by bd-2r4 in v0.10.0 - workspace auto-detected and shown in review output","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1cp","title":"Add reviews merge command","description":"Complete the review lifecycle by adding 'crit reviews merge <id>' to mark a review as merged. Should accept --commit flag or auto-detect from jj.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-25T17:33:18.859492164Z","created_by":"bob","updated_at":"2026-01-25T17:36:08.364049050Z","closed_at":"2026-01-25T17:36:08.364026728Z","close_reason":"Added reviews merge command with auto-detection from current commit","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1eh","title":"Add --verbose to threads list to show comment bodies","description":"Currently `crit threads list` only shows thread metadata:\n\n```\n[14]{comment_count,file_path,selection_end,selection_start,status,thread_id}:\n  0,src/attach.rs,150,144,open,th-lkxz\n  ...\n```\n\nAdd `--verbose` flag to include the first comment body (or all comments) inline:\n\n```bash\ncrit threads list cr-xxx --verbose\n```\n\nWould show:\n```\nth-lkxz src/attach.rs:144-150 (open, 1 comment)\n  [MEDIUM] Terminal restoration is fragile. The Drop-based cleanup...\n\nth-zrao src/attach.rs:204-259 (resolved, 1 comment)  \n  [HIGH] Unbounded buffer growth enables DoS...\n```","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-27T19:16:31.362314738Z","created_by":"bob","updated_at":"2026-01-27T19:33:39.267060118Z","closed_at":"2026-01-27T19:33:39.266990708Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1fk","title":"Research diff rendering options (delta, pure-Rust, etc)","description":"Evaluate options for side-by-side diff rendering:\n1. Shell out to delta if available\n2. Shell out to diff-so-fancy if available  \n3. Pure Rust implementation parsing jj diff --git\n4. Existing Rust crates (similar-asserts, etc)\n\nConsider: syntax highlighting, line number alignment, inline comment integration feasibility, fallback strategy.\n\nReference: opencode's diff format as inspiration.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T21:39:18.758140987Z","created_by":"bob","updated_at":"2026-01-25T21:42:00.786425787Z","closed_at":"2026-01-25T21:42:00.786355185Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1j2","title":"TUI: review list and navigation","description":"Main screen showing list of reviews.\n\n- List view with status, title, author, comment count\n- Filter by status (open/merged/all)\n- Enter to open review detail view\n- Basic vim-style navigation (j/k, gg, G)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-26T21:13:21.147439570Z","created_by":"bob","updated_at":"2026-01-28T20:39:05.217948089Z","closed_at":"2026-01-28T20:39:05.217928162Z","close_reason":"Superseded by dedicated crit-ui project","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1j2","depends_on_id":"bd-2rx","type":"blocks","created_at":"2026-01-26T21:13:24.739362062Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-1j7","title":"crit doctor command","description":"Health check command that verifies: jj installed and repo is jj-managed, .crit/ exists and is valid, events.jsonl is parseable, index.db is in sync. Output clear pass/fail for each check with remediation hints.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T13:24:35.766662909Z","created_by":"bob","updated_at":"2026-01-25T16:59:06.286116211Z","closed_at":"2026-01-25T16:59:06.286088068Z","close_reason":"Implemented doctor health check with jj/crit/events/sync validation and remediation hints","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1j7","depends_on_id":"bd-21c","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-1j7","depends_on_id":"bd-27u","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-1j7","depends_on_id":"bd-2sw","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1jl","title":"Rename tui command to ui","description":"Simple rename: 'crit tui' -> 'crit ui'","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-01-25T21:39:15.441719413Z","created_by":"bob","updated_at":"2026-01-25T21:42:31.820150530Z","closed_at":"2026-01-25T21:42:31.820126665Z","close_reason":"Renamed tui -> ui","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1lk","title":"Update review_reviewers projection to support re-requesting","description":"Modify apply_reviewers_requested() to use INSERT ... ON CONFLICT DO UPDATE instead of INSERT OR IGNORE. This allows requested_at and requested_by to be updated when the same reviewer is requested again (re-review scenario).\n\nChanges needed:\n- projection/mod.rs: Update SQL in apply_reviewers_requested() (line ~336)\n- Use ON CONFLICT (review_id, reviewer) DO UPDATE SET requested_at=?, requested_by=?\n- Add test case for re-requesting same reviewer","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-03T20:52:30.589982616Z","created_by":"bob","updated_at":"2026-02-03T22:26:12.730401294Z","closed_at":"2026-02-03T22:26:12.730383040Z","close_reason":"Merged (review cr-6v49 metadata lost due to workspace sync)","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":8,"issue_id":"bd-1lk","author":"botcrit-dev","text":"Started in workspace brave-oracle (/home/bob/src/botcrit/.workspaces/brave-oracle)","created_at":"2026-02-03T22:17:03Z"}]}
{"id":"bd-1mo","title":"Add crit inbox command","description":"Add a command showing reviews/threads awaiting the current agent's response:\n\n```bash\ncrit inbox\n# Reviews where you're a reviewer and haven't voted\n# Threads where you were @mentioned\n# Threads you opened that have new responses\n```\n\nHelps agents quickly identify where their attention is needed.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-28T00:05:54.347602783Z","created_by":"bob","updated_at":"2026-01-28T00:47:47.376438468Z","closed_at":"2026-01-28T00:47:47.376414013Z","close_reason":"Implemented crit inbox command showing reviews awaiting vote, threads with new responses, and open feedback on authored reviews","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1q8","title":"Feature: show date and time in channel history text output","description":"Currently botbus history shows just time (HH:MM), but not the date.\n\nCurrent output:\n  [14:31] botbus-dev: message\n\nThis makes it hard to tell if a message is from today, yesterday, or last week.\n\nDesired output:\n  [2026-01-31 14:31] botbus-dev: message\n\nOr relative dates for recent messages:\n  [Today 14:31] botbus-dev: message\n  [Yesterday 15:12] botbox-dev: message\n  [2026-01-29 10:00] other-agent: message\n\nNote: This only applies to TOON format output. JSON format already includes full timestamps.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-31T20:06:30.225514547Z","created_by":"bob","updated_at":"2026-01-31T20:07:37.826851140Z","closed_at":"2026-01-31T20:07:37.826831954Z","close_reason":"Filed in wrong repo, created bd-2ks and bd-2dx in ~/src/botbus instead","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1re","title":"Add batch thread resolve","description":"Allow resolving multiple threads in one command: crit threads resolve th-xxx th-yyy th-zzz --reason 'All fixed'","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-25T17:33:21.017340977Z","created_by":"bob","updated_at":"2026-01-25T17:40:44.749711582Z","closed_at":"2026-01-25T17:40:44.749684471Z","close_reason":"Implemented batch thread resolve - can now pass multiple thread IDs to 'crit threads resolve'","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1rh","title":"Document thread drift status meanings","description":"Thread listings show drift status like `shifted(+10)`, `deleted` but it's unclear what action (if any) is expected.\n\nQuestions to address in docs:\n- Does `deleted` mean the code was removed entirely?\n- Should threads auto-update their line references on rebase?\n- What's the expected workflow when code drifts significantly?\n\nMay also want a `crit threads refresh <review_id>` to update line numbers.","status":"closed","priority":3,"issue_type":"docs","created_at":"2026-01-28T00:05:54.356970188Z","created_by":"bob","updated_at":"2026-01-28T18:11:53.769031435Z","closed_at":"2026-01-28T18:11:53.768998082Z","close_reason":"Documented drift status meanings in spec.md and testing.md (unchanged/shifted/modified/deleted) and workflow guidance","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1s1","title":"LGTM vote doesn't override block in SQLite index","description":"When a reviewer casts block then later casts LGTM, the SQLite index retains the old block vote. The events.jsonl correctly records both votes in order, but the index query returns the stale block.\n\nWorkaround: rm .crit/index.db to force rebuild from events.\n\nRepro:\n1. crit block <id> --agent reviewer --reason 'issue'\n2. crit lgtm <id> --agent reviewer\n3. crit review <id> --json → votes array still shows block, not LGTM\n\nExpected: The LGTM vote from the same reviewer should replace the block vote.\n\nDiscovered in R4 eval (botbox bd-110.4). The reviewer correctly LGTMed after verifying fixes, but the review still showed as blocked. Required manual index rebuild to proceed.\n\nAcceptance criteria:\n- crit lgtm replaces a prior block vote from the same reviewer\n- crit review shows the latest vote per reviewer\n- No index rebuild needed\n\nTesting: Block a review, then LGTM it. Verify crit review shows LGTM.\n\n---\nINVESTIGATION (2026-01-31):\n\nAdded test test_reviewer_vote_replacement() which reproduces the exact scenario - it passes.  \nThe projection code uses ON CONFLICT (review_id, reviewer) DO UPDATE which correctly\nreplaces votes. This logic has been in place since voting was first implemented.\n\nUnable to reproduce the bug. Likely causes:\n- Transient DB corruption (fixed by manual rebuild)\n- Edge case that's already been resolved  \n- User error (not syncing between commands)\n\nThe test provides regression coverage. Recommend monitoring for recurrence.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-31T19:59:17.010646438Z","created_by":"bob","updated_at":"2026-01-31T21:17:20.278477548Z","closed_at":"2026-01-31T21:17:20.278454315Z","close_reason":"Fixed: truncation detection in sync_from_log handles jj working copy restoration. See test_bd_1s1_jj_restore_triggers_rebuild.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1s1","depends_on_id":"bd-2uy","type":"blocks","created_at":"2026-01-31T20:52:10.084924161Z","created_by":"bob","metadata":"{}","thread_id":""}],"comments":[{"id":1,"issue_id":"bd-1s1","author":"Bob","text":"Investigation (2026-01-31): Unable to reproduce. The projection code in apply_reviewer_voted() uses ON CONFLICT (review_id, reviewer) DO UPDATE which correctly replaces votes. This logic has been in place since the voting feature was first implemented (commit 35fbf37). Added test_reviewer_vote_replacement() in src/projection/mod.rs which passes — it blocks then LGTMs and verifies the vote is replaced and has_blocking_votes returns false. Likely causes: transient DB corruption, incomplete transaction, or edge case already resolved. The regression test provides future coverage. Recommend monitoring for recurrence before closing.","created_at":"2026-01-31T20:29:39Z"},{"id":2,"issue_id":"bd-1s1","author":"Bob","text":"Update from botbox-dev (2026-01-31 via #botcrit):\n\nEval env: /tmp/tmp.iyprC50GHo\n- All votes same identity (author=jasper-lattice, review_id=cr-fjf9)\n- No workspace merge between block and LGTM — both from default workspace\n- events.jsonl has all events intact (20 lines + trailing empty line)\n- The 4 LGTMs were NOT agent retries — first was the agent, next 3 were the human operator manually retrying after crit review kept showing block\n- Each crit lgtm returned success (event appended), but crit review continued showing block\n- Only rm .crit/index.db fixed it (full rebuild from events showed correct lgtm)\n- Current index.db at that path is the REBUILT one (shows correct state)\n\nRoot cause still unknown. Projection upsert logic is correct (test passes). Leading hypothesis: empty line handling in read_from() causes sync offset drift. See bd-2uy and bd-2t5 for test plan.","created_at":"2026-01-31T20:52:06Z"},{"id":4,"issue_id":"bd-1s1","author":"Bob","text":"INVESTIGATION UPDATE: Empty line hypothesis DISPROVEN via 8 passing reproduction tests.\n\nWhat was tested:\n- Incremental sync with eval data (on-disk DB, separate connections per CLI invocation)\n- Empty lines in middle/end of events.jsonl\n- Progressive drift accumulation\n- Full R4 eval event sequence with CLI batch pattern\n\nResult: The sync layer and projection layer work correctly in ALL scenarios. Block→lgtm override always succeeds. Empty line drift causes harmless re-processing, never vote regression.\n\nREMAINING HYPOTHESES to investigate:\n1. jj working copy restoration — if jj restores events.jsonl to an older state after a rewrite, the index.db (gitignored, persistent) would have a last_sync_line pointing past the restored file content, causing future events to be appended at a line that the DB thinks it already processed\n2. Multiple index.db files — if the eval created a workspace, .crit/index.db might exist in both main repo and workspace (both resolve to same crit_root, so unlikely)\n3. OS-level file system issue — buffered writes not visible to subsequent process (unlikely with flush())\n4. SQLite journal corruption — WAL or journal file preventing proper commit persistence\n\nMost promising: hypothesis #1 (jj working copy restoration). Need to verify whether the eval involved any jj rewrites (jj squash, jj rebase, etc.) between the block and lgtm commands.","created_at":"2026-01-31T21:09:47Z"},{"id":5,"issue_id":"bd-1s1","author":"Bob","text":"ROOT CAUSE FOUND AND FIXED.\n\nRoot cause: jj working copy restoration overwrites events.jsonl (tracked file) with an older version, while index.db (gitignored) retains a stale last_sync_line cursor. New events appended after the restore are at line positions BELOW the stale cursor, making them invisible to sync_from_log.\n\nFix: Added truncation detection to sync_from_log. When last_sync_line > total file lines, the projection is wiped and rebuilt from scratch. Also added total_lines() method to AppendLog trait for raw line counting (including empty lines).\n\nFiles changed:\n- src/log/mod.rs: Added total_lines() to AppendLog trait + FileLog implementation\n- src/projection/mod.rs: Added truncation detection to sync_from_log, added rebuild_projection function, added 10 reproduction/regression tests\n\nAll 123 tests pass.","created_at":"2026-01-31T21:17:20Z"}]}
{"id":"bd-1sc","title":"UI redesign: GitHub-style review interface","description":"Redesign TUI to be document-centric like GitHub:\n- Review list as entry point (open reviews at top)\n- Enter to select review -> shows diff with inline comments\n- Side-by-side diff (unified as fallback)\n- Files in scrollable stream with collapsible sections\n- File list pane on left when space permits\n- Inline comment threads (configurable: auto-expand on focus or manual)","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-25T21:39:21.917226892Z","created_by":"bob","updated_at":"2026-01-25T22:53:50.895971579Z","closed_at":"2026-01-25T22:53:50.895946562Z","close_reason":"Core TUI is functional with review list, detail view, diff rendering, file navigation, and comment display","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1sc","depends_on_id":"bd-14f","type":"blocks","created_at":"2026-01-25T21:59:02.292226724Z","created_by":"bob","metadata":"{}","thread_id":""},{"issue_id":"bd-1sc","depends_on_id":"bd-1wr","type":"blocks","created_at":"2026-01-25T21:59:01.975920456Z","created_by":"bob","metadata":"{}","thread_id":""},{"issue_id":"bd-1sc","depends_on_id":"bd-3ey","type":"blocks","created_at":"2026-01-25T21:59:02.132423372Z","created_by":"bob","metadata":"{}","thread_id":""},{"issue_id":"bd-1sc","depends_on_id":"bd-4mo","type":"blocks","created_at":"2026-01-25T21:59:01.647259092Z","created_by":"bob","metadata":"{}","thread_id":""},{"issue_id":"bd-1sc","depends_on_id":"bd-knb","type":"blocks","created_at":"2026-01-25T21:59:01.812556491Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-1sj","title":"ID generation (slugs)","description":"Implement short ID generation for reviews (cr-xxx), threads (th-xxx), comments (c-xxx). Should be collision-resistant and human-readable.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T04:03:55.529780553Z","created_by":"bob","updated_at":"2026-01-25T13:42:00.532818566Z","closed_at":"2026-01-25T13:42:00.532790253Z","close_reason":"Implemented with tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1sj","depends_on_id":"bd-jc0","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-1st","title":"Add --since filter for seeing new activity","description":"When re-reviewing, there's no way to see what changed since last visit. Add filtering options:\n\n```bash\ncrit threads list cr-klwd --with-new-comments\ncrit review cr-klwd --since 2026-01-27T23:00:00\ncrit review cr-klwd --since-vote  # since my last vote/comment\n```\n\nThis helps agents know where to focus attention on follow-up reviews.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-28T00:05:54.347704664Z","created_by":"bob","updated_at":"2026-01-28T00:23:54.044095014Z","closed_at":"2026-01-28T00:23:54.044059438Z","close_reason":"Implemented --since flag for crit review and crit threads list","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1u9","title":"Replace --json flag with --format option","description":"Change crit review (and other commands) from using a boolean --json flag to a --format option that accepts: toon (default, current TOON output), json (machine-readable), text (plain text).\n\n**Acceptance Criteria:**\n- --format flag accepts: toon, json, text\n- Default is toon (current behavior when no flag)\n- --json flag deprecated but still works (maps to --format=json) with deprecation warning\n- Applies to: crit review, crit reviews list, crit threads list, crit inbox, etc.\n- JSON output remains unchanged, only the CLI interface changes\n- Help text documents the new flag\n\n**Implementation notes:**\n- Update clap struct to use --format instead of --json\n- Add backward compat shim for --json\n- Consider adding this globally vs per-command","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T21:36:51.381278054Z","created_by":"bob","updated_at":"2026-02-01T22:00:20.993755448Z","closed_at":"2026-02-01T22:00:20.993727005Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1we","title":"Add --needs-review filter to reviews list","description":"Filter reviews where the current agent is a requested reviewer. Usage: crit reviews list --needs-review","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-25T17:33:19.753739215Z","created_by":"bob","updated_at":"2026-01-25T17:37:48.555289290Z","closed_at":"2026-01-25T17:37:48.555251659Z","close_reason":"Added --needs-review filter based on current agent identity","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1wr","title":"TUI diff has excessive blank lines (delta width)","description":"Delta side-by-side output has too many blank lines, likely because width=200 is too wide. Should pass actual terminal width to delta.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-25T21:58:50.684358047Z","created_by":"bob","updated_at":"2026-01-25T22:02:44.902840141Z","closed_at":"2026-01-25T22:02:44.902812199Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-1z5","title":"Demo project: README with crit command examples","description":"Create demo/README.md showing what running crit commands looks like in the demo project. Include actual command output for:\n- crit reviews list\n- crit review <id>\n- crit threads list <id> -v\n- crit status <id>\n- crit inbox\n- crit doctor\nThis README lives inside the demo project and serves as a walkthrough.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-28T21:22:01.930287844Z","created_by":"bob","updated_at":"2026-01-28T22:25:38.674426374Z","closed_at":"2026-01-28T22:25:38.674408521Z","close_reason":"Created docs/demo.md with actual crit output examples: reviews list, full review view, threads list, inbox (two perspectives), and doctor.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-1z5","depends_on_id":"bd-22q","type":"blocks","created_at":"2026-01-28T21:22:11.057600251Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-1zz","title":"Adopt maw output conventions for agent-friendly tool output","description":"Apply maw's output guidelines to crit:\n- Errors include what failed + how to fix (exact command)\n- Success output includes what happened + next steps (exact commands)\n- Every message must stand alone (agents can't remember prior output)\n- Use structured prefixes: WARNING:, IMPORTANT:, To fix:, Next:\n- Assume zero prior knowledge - explain concepts on first use\n- Keep it brief (token-conscious)\n- Include copy-pasteable commands\n\nFocus areas:\n- crit init output\n- crit reviews create output\n- crit doctor output\n- Error messages throughout\n- Help text improvements","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T02:25:32.845195522Z","created_by":"bob","updated_at":"2026-01-31T02:30:50.929238643Z","closed_at":"2026-01-31T02:30:50.929215680Z","close_reason":"Implemented output guidelines from maw","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-20l","title":"Make generated AGENTS.md instructions more concise","description":"The crit agent instructions generated by 'crit agents init' are verbose. Condense them while preserving essential info for agents.","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-01-27T20:30:58.500484362Z","created_by":"bob","updated_at":"2026-01-27T20:31:47.698957180Z","closed_at":"2026-01-27T20:31:47.698927514Z","close_reason":"Reduced from 121 to 31 lines","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-21c","title":"clap command structure","description":"Define CLI structure with clap: crit init, crit reviews {create,list,show,request,approve,abandon}, crit threads {create,list,show,resolve,reopen}, crit comments {add,list}, crit status, crit diff. Include global --json flag.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-25T04:04:37.916924937Z","created_by":"bob","updated_at":"2026-01-25T13:42:14.001157855Z","closed_at":"2026-01-25T13:42:14.001139561Z","close_reason":"Implemented","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-21c","depends_on_id":"bd-2sw","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-21y","title":"Add file context to crit review JSON output","description":"Currently, crit review --json outputs review metadata and threads, but does NOT include file context (code snippets) for threads. The TOON output shows context via extract_context(), but JSON doesn't capture this.\n\n**Problem:**\nUIs built on crit (like TUIs) need file context for all threads, including:\n1. Threads on files IN the change but OUTSIDE changed lines\n2. Threads on files NOT in the change at all\n3. Threads on changed lines (standard case)\n\n**Acceptance Criteria:**\n- crit review --format=json includes a 'context' field for each thread\n- Context includes: lines[], start_line, end_line, anchor_start, anchor_end\n- Context shows file state from the review's commit (not latest)\n- Handles missing files gracefully (context: null if file doesn't exist)\n- Works for all three edge cases above\n\n**JSON Schema (draft):**\n{\n  \"threads\": [{\n    \"thread_id\": \"th-abc\",\n    \"file_path\": \"src/main.rs\",\n    \"selection_start\": 42,\n    \"selection_end\": 43,\n    \"context\": {\n      \"lines\": [{\"line_number\": 40, \"content\": \"...\", \"is_anchor\": false}, ...],\n      \"start_line\": 40,\n      \"end_line\": 45,\n      \"anchor_start\": 42,\n      \"anchor_end\": 43\n    }\n  }]\n}","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-01T21:37:01.856272266Z","created_by":"bob","updated_at":"2026-02-01T22:01:53.816770873Z","closed_at":"2026-02-01T22:01:53.816746337Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-21y","depends_on_id":"bd-1u9","type":"blocks","created_at":"2026-02-01T21:37:15.561008071Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-22q","title":"Demo project: generate realistic crit data","description":"Create a script (scripts/generate-demo.sh) that:\n- Creates ../demo directory\n- Inits a jj repo there with some sample source files\n- Runs crit init\n- Exercises most crit features: creates reviews, adds comments, replies, threads, resolves threads, votes (lgtm/block), requests reviewers, approves, merges, abandons\n- Uses multiple agent identities for realism (e.g. swift-falcon, bold-tiger, quiet-owl)\n- Generates enough data to show all views meaningfully\n- Should be idempotent (rm -rf and regenerate)\n- Output should include the demo directory path","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-28T21:21:54.742980138Z","created_by":"bob","updated_at":"2026-01-28T22:09:43.540474909Z","closed_at":"2026-01-28T22:09:43.540455573Z","close_reason":"Created scripts/generate-demo.sh — generates 3 reviews (open/merged/abandoned), 7 threads, replies, votes, and resolves in a /tmp jj repo. All crit features exercised.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-25a","title":"TUI (ratatui)","description":"Interactive terminal UI for code review - lower priority","status":"closed","priority":3,"issue_type":"epic","created_at":"2026-01-25T04:05:00.607245091Z","created_by":"bob","updated_at":"2026-01-25T22:53:50.908593065Z","closed_at":"2026-01-25T22:53:50.908570813Z","close_reason":"Core TUI is functional with review list, detail view, diff rendering, file navigation, and comment display","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-25z","title":"Standardize CLI argument names","description":"Inconsistent arg names hurt discoverability. Changes needed:\n- Use --description everywhere (allow --desc as alias)\n- Consider --message for comments instead of positional MESSAGE\n- Audit all commands for consistency","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-01-25T18:19:54.521745793Z","created_by":"bob","updated_at":"2026-01-25T19:46:33.528804467Z","closed_at":"2026-01-25T19:46:33.528783668Z","close_reason":"Implemented: --description with --desc alias, --message/--msg for comments, --reviewer alias for reviewers","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-26k","title":"crit reviews list: add --status filter","description":"Add --status <open|merged|abandoned> filter to crit reviews list. Currently reviewers must parse JSON client-side to find open reviews. Server-side filtering simplifies the reviewer-loop has_work() check and avoids processing merged/abandoned reviews.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-02T00:45:16.138955781Z","created_by":"bob","updated_at":"2026-02-02T00:54:45.560232201Z","closed_at":"2026-02-02T00:54:45.560203517Z","close_reason":"Already implemented - crit reviews list --status=open works","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-26n","title":"Projection Engine","description":"SQLite-based query layer for efficient reads from the event log","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-25T04:04:01.784271737Z","created_by":"bob","updated_at":"2026-01-25T13:42:03.951644162Z","closed_at":"2026-01-25T13:42:03.951626559Z","close_reason":"Projection epic complete - schema designed","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-27u","title":"JJ command wrapper","description":"Create JjRepo struct that wraps std::process::Command calls to jj. Methods: get_current_change_id(), get_current_commit(), diff_files(), show_file_at_commit(). Handle jj not installed gracefully.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-25T04:04:21.956812968Z","created_by":"bob","updated_at":"2026-01-25T13:50:34.428801589Z","closed_at":"2026-01-25T13:50:34.428779367Z","close_reason":"Implemented with all jj commands wrapped","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-27u","depends_on_id":"bd-2ws","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-27u","depends_on_id":"bd-3q7","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-287","title":"Add --has-unresolved filter to reviews list","description":"Filter reviews that have at least one unresolved thread. Useful for finding reviews that need attention.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-25T17:33:23.287855096Z","created_by":"bob","updated_at":"2026-01-25T17:37:48.682318086Z","closed_at":"2026-01-25T17:37:48.682292037Z","close_reason":"Added --has-unresolved filter to show reviews with open threads","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-28d","title":"Drift detection algorithm","description":"Implement line mapping from original_commit to current_commit. Parse unified diff format. Calculate current line numbers for threads. Detect when anchored lines are modified/deleted (Detached status).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-25T04:04:24.106438195Z","created_by":"bob","updated_at":"2026-01-25T14:19:41.591014281Z","closed_at":"2026-01-25T14:19:41.590994113Z","close_reason":"Implemented drift detection with diff parsing","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-28d","depends_on_id":"bd-27u","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-28d","depends_on_id":"bd-3q7","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-29k","title":"Clean up dead code warnings in TUI","description":"Fix compiler warnings for unused code:\n- theme.rs:25 - CONFLICT constant is never used\n- review_detail.rs:63 - target_commit field is never read\n\nEither use these items or remove them.","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-02-03T23:34:08.482122489Z","created_by":"botcrit-dev","updated_at":"2026-02-03T23:40:50.576119187Z","closed_at":"2026-02-03T23:40:50.576088159Z","close_reason":"Fixed: added #[allow(dead_code)] annotations with doc comments","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":13,"issue_id":"bd-29k","author":"botcrit-dev","text":"Started in workspace calm-forest (/home/bob/src/botcrit/.workspaces/calm-forest)","created_at":"2026-02-03T23:34:35Z"}]}
{"id":"bd-2a4","title":"Automated screenshots of demo project","description":"Create scripts/screenshot-demo.sh following the pattern from ~/src/botbus/scripts/screenshot-tui.sh. Automate capturing screenshots of:\n- crit reviews list output\n- crit review <id> (full review view)\n- crit threads list <id> -v\n- crit inbox\n- crit ui (TUI screenshot using kitty + hyprctl + grim)\nSave to images/ directory. Use pngquant for compression.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T21:22:03.037098226Z","created_by":"bob","updated_at":"2026-01-28T22:29:56.076687203Z","closed_at":"2026-01-28T22:29:56.076653260Z","close_reason":"Created scripts/screenshot-demo.sh — captures 6 screenshots (reviews-list, review, threads-list, inbox, doctor, tui) using kitty+hyprctl+grim+pngquant. All saved to images/.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2a4","depends_on_id":"bd-22q","type":"blocks","created_at":"2026-01-28T21:22:11.329360182Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-2bd","title":"Document thread/comment workflow for agents","description":"The AGENTS.md or README should explicitly document that:\n\n1. `threads create` only creates the thread container - you MUST call `comments add` to write actual feedback\n2. Provide a complete example workflow for agents:\n\n```bash\n# Create review\ncrit reviews create --title \"...\"\n\n# Add feedback (currently requires two steps)\nTHREAD=$(crit threads create cr-xxx --file foo.rs --line 42 --json | jq -r .thread_id)\ncrit comments add $THREAD \"Your comment here\"\n\n# Or in one line\ncrit comments add $(crit threads create cr-xxx --file foo.rs --line 42 --json | jq -r .thread_id) \"Comment\"\n```\n\n3. Document the approval → merge flow\n\nA subagent failed to add comments because this wasn't clear - it created 14 empty threads.","status":"closed","priority":2,"issue_type":"docs","created_at":"2026-01-27T19:16:58.360906694Z","created_by":"bob","updated_at":"2026-01-27T19:28:24.071293631Z","closed_at":"2026-01-27T19:28:24.071265318Z","close_reason":"Fixed: ran 'crit agents init' in botty to add complete workflow docs including 'crit comment'","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2cs","title":"Add --conversation flag to threads show","description":"Display thread as a conversation with timestamps and author names in a readable format, rather than structured data.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-25T17:33:22.333059089Z","created_by":"bob","updated_at":"2026-01-25T17:42:39.683829836Z","closed_at":"2026-01-25T17:42:39.683802655Z","close_reason":"Implemented --conversation flag for threads show - displays thread as human-readable conversation with timestamps","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2do","title":"crit diff: resolve jj change ID dynamically for re-reviews","description":"Currently crit diff stores initial_commit but no current_commit. When an author fixes code and the jj change is rewritten, crit diff fails because it tries to diff from initial_commit to nothing.\n\nFix: crit diff should resolve the jj_change_id (which is stable across rewrites) to its current commit at diff time, then diff parent..current. This makes re-reviews work without the reviewer needing to know workspace paths.\n\nDiscovered in R4 eval (botbox bd-110.4): reviewer couldn't see fixed code because crit diff didn't work after the author committed fixes in a workspace.\n\nAcceptance criteria:\n- crit diff <id> works after author rewrites the change\n- Diff shows the latest state of the change, not the initial commit\n- Works across workspaces (change may live in a non-default workspace)\n\nTesting: Create a review, make changes, run crit diff — should show updated diff.\n\n---\nFIXED (2026-01-31):\n\nRoot cause: crit diff was computing base_commit = parent(initial_commit), then \nresolving target_commit from jj_change_id. When the author rewrote the change,\ninitial_commit might no longer exist, causing get_parent_commit to fail.\n\nSolution: Swapped the order - now resolves target_commit FIRST from jj_change_id,\nthen computes base_commit = parent(target_commit). This handles rewrites correctly\nsince jj_change_id is stable across rewrites.\n\nChanged in: src/cli/commands/status.rs run_diff function","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-31T19:59:07.211000146Z","created_by":"bob","updated_at":"2026-01-31T20:18:43.989977193Z","closed_at":"2026-01-31T20:18:43.989946956Z","close_reason":"Fixed in src/cli/commands/status.rs - swapped order to resolve target_commit first, then get its parent","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2fq","title":"Context extraction","description":"Extract code context around thread anchors. Support configurable context lines (default 3). Handle edge cases: file deleted, line at start/end of file.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T04:04:25.471996804Z","created_by":"bob","updated_at":"2026-01-25T14:19:41.812319627Z","closed_at":"2026-01-25T14:19:41.812301473Z","close_reason":"Implemented context extraction","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2fq","depends_on_id":"bd-27u","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-2fq","depends_on_id":"bd-3q7","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2i3","title":"Add crit review command for full review display","description":"Currently viewing a full review with all threads and comments requires multiple commands:\n\n```bash\ncrit reviews show cr-xxx\ncrit threads list cr-xxx\ncrit threads show th-xxx  # for each thread\n```\n\nAdd a single command that shows the complete review:\n\n```bash\ncrit review cr-xxx\n```\n\nShould display:\n- Review metadata (title, status, author, dates)\n- All threads with their comments inline\n- Code context for each thread\n\nSimilar to `gh pr view` which shows the full PR with comments.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-27T19:16:26.160574345Z","created_by":"bob","updated_at":"2026-01-27T19:35:28.860818651Z","closed_at":"2026-01-27T19:35:28.860745404Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2if","title":"Bug: channel history --format toon|json doesn't work","description":"The botbus history command doesn't accept --format flag for controlling output format.\n\nCurrent behavior:\n  botbus history botcrit --format json\n  Error: unexpected argument '--format'\n\nExpected behavior:\n  Should support --format json and --format toon like other commands\n\nThis is inconsistent with other botbus commands that support --format.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-31T20:06:22.780075505Z","created_by":"bob","updated_at":"2026-01-31T20:07:37.822130354Z","closed_at":"2026-01-31T20:07:37.822102361Z","close_reason":"Filed in wrong repo, created bd-2ks and bd-2dx in ~/src/botbus instead","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2m6","title":"events.jsonl truncation during concurrent operations","description":"Reported via maw project (botbus-dev):\n\ncrit events.jsonl was truncated during workspace merge, causing review cr-5v5r to be lost. The crit warning was 'events.jsonl truncated (expected >=34 lines, found 26). Rebuilding projection.'\n\nEarlier also reported: Review cr-q947 was lost during workflow (reviewer signed off without finding it).\n\nThis is occurring in a jj workspace environment. Multiple workspaces share the same .crit/ directory. The events.jsonl may be getting corrupted during concurrent writes.\n\nAcceptance criteria:\n- Investigate root cause of truncation\n- Add file locking or atomic writes to events.jsonl\n- Ensure reviews cannot be silently lost\n- Add recovery mechanism if truncation detected","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-02-03T21:52:14.669331851Z","created_by":"maw-dev","updated_at":"2026-02-03T22:16:11.346637656Z","closed_at":"2026-02-03T22:16:11.346612799Z","close_reason":"Implemented orphan review backup on truncation detection. Review cr-kbhq merged.","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":7,"issue_id":"bd-2m6","author":"botcrit-dev","text":"Started in workspace electric-pine (/home/bob/src/botcrit/.workspaces/electric-pine)","created_at":"2026-02-03T22:04:22Z"}]}
{"id":"bd-2qu","title":"crit agents command","description":"Manage AGENTS.md integration. 'crit agents init' inserts crit usage instructions into AGENTS.md (or creates it). 'crit agents show' outputs the instructions block to stdout. Use HTML comment markers for idempotent updates.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T13:24:37.707475007Z","created_by":"bob","updated_at":"2026-01-25T13:54:35.246105685Z","closed_at":"2026-01-25T13:54:35.246089104Z","close_reason":"Implemented crit agents init/show commands","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2qu","depends_on_id":"bd-21c","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-2qu","depends_on_id":"bd-2sw","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2r4","title":"crit review: show workspace path for change under review","description":"When displaying a review, crit should show which workspace contains the change. Since crit stores the jj_change_id, it can resolve this via jj workspace list to find which workspace has the change checked out.\n\nExample output:\n  ○ cr-fjf9 · feat: add GET /files/:name endpoint\n    Status: open | Author: mystic-birch\n    Workspace: silver-gateway (/abs/path/.workspaces/silver-gateway)\n\nThis helps reviewers (especially during re-review) find the code without needing explicit workspace paths in their prompts.\n\nDiscovered in R4 eval (botbox bd-110.4): reviewer read src/main.rs from project root instead of .workspaces/silver-gateway/src/main.rs.\n\nAcceptance criteria:\n- crit review <id> shows workspace name and path if the change is in a non-default workspace\n- Works with both human-readable and --json output\n- Gracefully handles case where workspace was already destroyed\n\nTesting: Create a review in a workspace, run crit review — should show workspace path.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-31T19:59:24.697125845Z","created_by":"bob","updated_at":"2026-02-01T22:10:33.135216586Z","closed_at":"2026-02-01T22:10:33.135189185Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2rx","title":"Basic ratatui app scaffold","description":"Set up ratatui with crossterm. Implement basic app loop, event handling, quit functionality. Create reusable widget patterns.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-25T04:05:05.776604392Z","created_by":"bob","updated_at":"2026-01-28T20:39:00.263375408Z","closed_at":"2026-01-28T20:39:00.263356372Z","close_reason":"Superseded by dedicated crit-ui project","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2rx","depends_on_id":"bd-168","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-2rx","depends_on_id":"bd-25a","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-2rx","depends_on_id":"bd-o9a","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2rz","title":"Add 'crit comment' command with auto-thread creation","description":"New command: crit comment <review-id> --file <file> --line <line> <message>\n\n1. Check if thread exists at file+line for this review\n2. If not, create thread automatically\n3. Add comment to thread\n4. Return both thread_id and comment_id\n\nShould also support --lines for ranges (e.g., --lines 10-15)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-26T20:18:57.530240913Z","created_by":"bob","updated_at":"2026-01-26T20:54:56.172971115Z","closed_at":"2026-01-26T20:54:56.172943904Z","close_reason":"Implemented: crit comment command","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2rz","depends_on_id":"bd-13u","type":"blocks","created_at":"2026-01-26T20:19:02.483001692Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-2sw","title":"CLI (crit)","description":"Command-line interface for botcrit","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-25T04:04:31.875609129Z","created_by":"bob","updated_at":"2026-01-25T13:42:13.079094659Z","closed_at":"2026-01-25T13:42:13.079076555Z","close_reason":"CLI epic - clap structure and init implemented","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2t5","title":"Test sync_from_log with trailing empty lines and partial batches","description":"The eval events.jsonl has 20 events + 1 trailing empty line. The read_from() function in src/log/mod.rs skips empty lines but enumerate() still counts them. sync_from_log sets new_line = last_line + events.len() where events.len() excludes empty lines.\n\nHypothesis: If events.jsonl has empty lines interspersed (not just trailing), the line-count-based offset tracking in sync_state could drift from the actual file line positions.\n\nTest:\n1. Create events.jsonl with known events + empty lines between them\n2. Sync incrementally (not all at once)\n3. Verify each sync processes the correct events\n4. Specifically test: add empty line before a vote event, sync, then check if the vote was processed\n\nIf this fails, the fix is to track byte offset or content hash instead of line count.\n\nKey code:\n- src/log/mod.rs: read_from() lines 92-133 — skips empty lines but idx still counts them\n- src/projection/mod.rs: sync_from_log() line 147 — new_line = last_line + count","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T20:51:39.225116907Z","created_by":"bob","updated_at":"2026-01-31T21:09:33.356354565Z","closed_at":"2026-01-31T21:09:33.356331211Z","close_reason":"Superseded: empty line drift confirmed harmless (re-processing only, never skipping). See test_bd_1s1_multiple_empty_lines_drift.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2t5","depends_on_id":"bd-2uy","type":"blocks","created_at":"2026-01-31T20:51:52.884769730Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-2ur","title":"Demo script should generate comments outside changed ranges","description":"Ensure generate-demo.sh creates:\n1. Comments on files IN the change but OUTSIDE the changed range (e.g., main.rs changed lines 3-10, comment on lines 50-55)\n2. Comments on files NOT in the change at all (e.g., api.rs not changed, but has comments)\n\nThese are important edge cases for UI testing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-02-01T19:48:29.767677223Z","created_by":"bob","updated_at":"2026-02-01T19:51:57.452645580Z","closed_at":"2026-02-01T19:51:57.452622838Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-2uy","title":"Reproduce bd-1s1 with eval data incremental sync simulation","description":"Write a test that simulates the exact incremental sync pattern from the R4 eval.\n\nContext: The eval env at /tmp/tmp.iyprC50GHo has events.jsonl with 20 events. The bug: after block vote at line 14 and LGTM at line 15, crit review still showed block. Rebuilding index.db fixed it.\n\nTest approach:\n1. Copy eval events.jsonl into test fixture\n2. Create an in-memory ProjectionDb  \n3. Simulate incremental syncs matching the CLI command pattern:\n   - Feed events in batches (2 at a time for comment commands, 1 for votes)\n   - After each batch, update last_sync_line\n   - Check vote state after processing the block (should be block)\n   - Check vote state after processing the LGTM (should be lgtm)\n4. If this passes, try with the FULL 20-event file using read_from offsets\n\nKey files:\n- src/projection/mod.rs (sync_from_log, apply_reviewer_voted)\n- src/log/mod.rs (read_from with empty line skipping)\n- Test data: /tmp/tmp.iyprC50GHo/.crit/events.jsonl\n\nThe eval events.jsonl has a trailing empty line (line 21). Check if empty line skipping in read_from causes an off-by-one in last_sync_line calculation.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-31T20:51:29.120730232Z","created_by":"bob","updated_at":"2026-01-31T21:09:33.314891089Z","closed_at":"2026-01-31T21:09:33.314867685Z","close_reason":"Reproduction complete. Empty line hypothesis disproven. See test suite (test_bd_1s1_*) for 8 passing tests. Root cause is not in sync/projection layers.","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":3,"issue_id":"bd-2uy","author":"Bob","text":"REPRODUCTION RESULTS: All 8 tests pass. Empty line hypothesis is DISPROVEN as root cause.\n\nKey findings:\n1. Trailing empty lines (as in eval data) do NOT cause sync drift — read_from(N) skips them at end, returns empty, no re-processing.\n2. Middle empty lines DO cause sync offset drift (last_sync advances by event count, not line count), BUT this only causes re-processing of events in forward order — never vote regression.\n3. The eval data works correctly in both full sync and incremental sync modes with on-disk DB persistence.\n4. The on-disk persistence test (simulating separate CLI process invocations) works correctly.\n\nThe block→lgtm override works correctly in ALL tested scenarios:\n- Baseline incremental sync\n- Empty lines between votes\n- Multiple empty lines causing major drift\n- Progressive drift with on-disk DB\n- Full R4 eval data with CLI batch pattern\n- Eval data with trailing empty line\n\nRoot cause is NOT in the sync layer or projection layer. Need to investigate other hypotheses.","created_at":"2026-01-31T21:09:26Z"}]}
{"id":"bd-2ws","title":"Research: jj CLI output formats","description":"Investigate jj log, jj diff, jj show output formats. Determine best way to extract change_id, commit_hash, file diffs. Check if jj has --json or machine-readable output modes.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-25T04:04:20.059371108Z","created_by":"bob","updated_at":"2026-01-25T13:42:09.267385259Z","closed_at":"2026-01-25T13:42:09.267367025Z","close_reason":"Research documented in notes/jj-research.md","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-2ws","depends_on_id":"bd-3q7","type":"blocks","created_at":"2026-01-25T17:33:17Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-2xl","title":"TUI: selecting file should scroll to it","description":"When selecting a file in the file list, scroll the diff pane to show that file.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-25T22:43:27.280336344Z","created_by":"bob","updated_at":"2026-01-25T22:45:58.473408580Z","closed_at":"2026-01-25T22:45:58.473376620Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-30e","title":"Add review request status to inbox (fresh vs re-review)","description":"Update get_reviews_awaiting_vote() to show reviews needing attention after re-request. A review should appear in inbox if: (1) reviewer never voted, OR (2) reviewer voted but requested_at > voted_at.\n\nChanges needed:\n- projection/query.rs: Update ReviewAwaitingVote struct with request_status: String\n- projection/query.rs: Modify get_reviews_awaiting_vote() query:\n  * Join review_reviewers with reviewer_votes (LEFT JOIN)\n  * Show if: v.vote IS NULL OR rr.requested_at > v.voted_at\n  * Compute request_status: 'fresh' if never voted, 're-review' if voted but re-requested\n- output/mod.rs: Update TOON formatting to show status (e.g. [re-review] indicator)\n- Add test cases for re-request inbox behavior\n\nDependencies: bd-1lk","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-03T20:52:38.738483126Z","created_by":"bob","updated_at":"2026-02-03T22:45:22.305561433Z","closed_at":"2026-02-03T22:45:22.305536086Z","close_reason":"Merged: Added request_status field (fresh/re-review) to inbox, updated query for re-requests, TOON shows [re-review] indicator. 5 tests.","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":10,"issue_id":"bd-30e","author":"botcrit-dev","text":"Started in workspace gold-tower (/home/bob/src/botcrit/.workspaces/gold-tower)","created_at":"2026-02-03T22:34:44Z"}]}
{"id":"bd-320","title":"Document reviewer re-request workflow and add CLI examples","description":"Update documentation to explain the reviewer re-request workflow and provide CLI examples.\n\nChanges needed:\n- CLAUDE.md: Add section explaining reviewer inbox behavior:\n  * Review appears in inbox when first requested\n  * Disappears after voting\n  * Reappears if author re-requests via 'crit reviews request <review_id> --reviewers <name>'\n  * Status field shows 'fresh' vs 're-review'\n- Add examples to reviews.rs output next steps\n- Consider adding --involved flag to 'crit inbox' to show all reviews user participated in (optional stretch goal)\n\nDependencies: bd-30e","status":"closed","priority":2,"issue_type":"docs","created_at":"2026-02-03T20:52:46.393623097Z","created_by":"bob","updated_at":"2026-02-03T22:51:28.057463067Z","closed_at":"2026-02-03T22:51:28.057427931Z","close_reason":"Merged: Added Reviewer Re-Request Workflow section to AGENTS.md and updated reviews create output with re-request example.","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":11,"issue_id":"bd-320","author":"botcrit-dev","text":"Started in workspace stellar-eagle (/home/bob/src/botcrit/.workspaces/stellar-eagle)","created_at":"2026-02-03T22:46:58Z"}]}
{"id":"bd-32d","title":"TUI: full-width box for file section headers","description":"File section headers should be full-width boxes with filename centered, not just inline text.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-25T22:43:30.665118027Z","created_by":"bob","updated_at":"2026-01-25T22:44:54.496327694Z","closed_at":"2026-01-25T22:44:54.496309360Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-33i","title":"Conversation view improvements","description":"Enhancements for --conversation flag:\n- Add --no-context shorthand for --context 0\n- Add color output when terminal supports it (author names, status indicators, code highlighting)\n- Consider --compact mode for less verbose output","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-25T18:19:59.544183756Z","created_by":"bob","updated_at":"2026-01-25T19:49:50.497146565Z","closed_at":"2026-01-25T19:49:50.496947722Z","close_reason":"Added --no-context shorthand and color output support for conversation view","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-351","title":"Agent identity resolution","description":"Implement author field resolution with priority: --author flag > CRIT_AGENT env > BOTBUS_AGENT env > USER env. Create a get_agent_identity() function.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T04:03:53.947969969Z","created_by":"bob","updated_at":"2026-01-25T13:42:00.536244723Z","closed_at":"2026-01-25T13:42:00.536222211Z","close_reason":"Implemented with tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-351","depends_on_id":"bd-jc0","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-35l","title":"No formal approve/block mechanism for reviewers","description":"Currently there's no way for reviewers to formally approve or request changes to a review. The review approval is done by manually running 'crit reviews approve' rather than having reviewers signal their approval state.\n\nSuggested workflow:\n1. Reviewer runs 'crit reviews lgtm <review-id>' to approve\n2. Reviewer runs 'crit reviews block <review-id> --reason=...' to request changes\n3. Review status tracks which reviewers have approved/blocked\n4. 'crit reviews merge' should require approval from all requested reviewers (or at least no blocks)\n\nThis would make the review process more structured and prevent accidentally merging without proper review.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-26T20:16:24.630126243Z","created_by":"bob","updated_at":"2026-01-26T22:40:24.821412298Z","closed_at":"2026-01-26T22:40:24.821388834Z","close_reason":"Implemented lgtm/block voting commands with merge guard","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-36m","title":"Remove --request-id and --expected-hash from comments add","description":"These optimistic concurrency features add complexity without sufficient benefit for a code review tool. Duplicate comments are low-stakes and easily visible. Remove to simplify the CLI.","status":"closed","priority":2,"issue_type":"chore","created_at":"2026-01-25T21:05:37.505169302Z","created_by":"bob","updated_at":"2026-01-25T21:07:56.140979959Z","closed_at":"2026-01-25T21:07:56.140943261Z","close_reason":"Removed --request-id and --expected-hash from comments add. Simplified event struct and projection.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-36z","title":"Agent reviewers hit 400 errors from tool use concurrency issues","description":"When spawning Claude agents as reviewers via botty, one agent hit an API error:\n\n'API Error: 400 due to tool use concurrency issues'\n\nThis is a Claude API issue, not crit. The error happens when Claude makes concurrent tool calls that conflict. This is outside crit's control.\n\nWorkaround: Retry the operation, or ensure agents don't make concurrent file writes.\n\nMarking as P4/backlog since this is not actionable from crit's side.","status":"closed","priority":4,"issue_type":"bug","created_at":"2026-01-26T20:16:17.053925345Z","created_by":"bob","updated_at":"2026-01-26T22:32:54.482003445Z","closed_at":"2026-01-26T22:32:54.481976184Z","close_reason":"can't control","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-37x","title":"Epic: Per-review event log architecture","description":"Split events.jsonl into per-review event logs to eliminate merge conflicts and data loss in multi-workspace workflows.\n\n## New Structure\n```\n.crit/\n  version           # data format version (e.g., \"2\")\n  reviews/\n    cr-abc123/\n      events.jsonl  # only events for this review\n    cr-def456/\n      events.jsonl\n  index.db          # projection rebuilt from all review event logs\n```\n\n## Sub-tasks\n- bd-3u8: Implement per-review event log read/write\n- bd-3u9: Update projection to scan reviews/*/events.jsonl\n- bd-3ua: Remove crit_root forcing for event writes\n- bd-3ub: Migration tool (crit migrate)\n- bd-3uc: Version detection and enforcement\n\n## Success Criteria\n- Concurrent reviews in different workspaces never conflict\n- Workspace merges only conflict if same review touched in both\n- maw auto-resolve works correctly (per-review granularity)\n- Existing repos migrate cleanly\n- Full test coverage for edge cases","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-02-04T15:38:23.432356188Z","created_by":"bob","updated_at":"2026-02-04T17:24:04.114537824Z","closed_at":"2026-02-04T17:24:04.114504662Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3a4","title":"Implement per-review event log read/write","description":"Create new FileLog variant that writes to per-review paths.\n\n## Changes\n- Add `ReviewLog` struct: `.crit/reviews/{review_id}/events.jsonl`\n- Create directory on first write for a review\n- Update `AppendLog` trait if needed\n- All 21 append call sites need review_id context\n\n## Files to modify\n- src/log/mod.rs: Add ReviewLog implementation\n- src/cli/commands/reviews.rs: 8 append sites\n- src/cli/commands/threads.rs: 4 append sites  \n- src/cli/commands/comments.rs: 3 append sites\n\n## Testing\n- Write events to new structure\n- Verify directory creation\n- Concurrent writes to different reviews\n- Concurrent writes to same review (still needs locking)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-04T15:38:31.422012263Z","created_by":"bob","updated_at":"2026-02-04T17:19:30.922813957Z","closed_at":"2026-02-04T17:19:30.922781927Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":18,"issue_id":"bd-3a4","author":"Bob","text":"Implemented: ReviewLog struct, list_review_ids(), read_all_reviews(), open_or_create_review(). Full test coverage.","created_at":"2026-02-04T15:47:47Z"}]}
{"id":"bd-3bx","title":"Add --body flag to threads create","description":"Currently creating a thread with a comment requires two commands:\n\n```bash\ncrit threads create cr-xxx --file foo.rs --line 42\ncrit comments add th-xxx \"Your comment here\"\n```\n\nThis caused a subagent to create 14 empty threads - it tried `--body` which doesn't exist.\n\nAdd `--body` (or `--message`) flag to `threads create` to create the thread with an initial comment in one step:\n\n```bash\ncrit threads create cr-xxx --file foo.rs --line 42 --body \"Your comment here\"\n```\n\nThis is the common case and should be easy.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-27T19:16:22.814357002Z","created_by":"bob","updated_at":"2026-01-27T19:28:19.535758275Z","closed_at":"2026-01-27T19:28:19.535696279Z","close_reason":"Already implemented: 'crit comment' command does this - added docs to botty AGENTS.md","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3d5","title":"TUI: comment composition mode","description":"Allow adding comments from within the TUI.\n\n- Press 'c' on a diff line to start composing\n- Text input area appears\n- Submit with Ctrl+Enter, cancel with Esc\n- Uses existing crit comment infrastructure","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-26T21:13:19.071355751Z","created_by":"bob","updated_at":"2026-01-28T20:39:05.224526593Z","closed_at":"2026-01-28T20:39:05.224497258Z","close_reason":"Superseded by dedicated crit-ui project","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3d5","depends_on_id":"bd-wsn","type":"blocks","created_at":"2026-01-26T21:13:24.532975841Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-3eo","title":"TUI: clicking files should select them","description":"Mouse click on file in file list should select that file.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-25T22:43:23.637637188Z","created_by":"bob","updated_at":"2026-01-25T22:47:46.624254501Z","closed_at":"2026-01-25T22:47:46.624227440Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3ey","title":"TUI does not display inline comments","description":"Comments are not visible in the review detail view. Need to render thread comments inline between diff lines.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-25T21:58:54.352027079Z","created_by":"bob","updated_at":"2026-01-25T22:05:40.625304581Z","closed_at":"2026-01-25T22:05:40.625276788Z","close_reason":"Inline comment rendering implemented; test data issue causes no visible comments in demo","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3gk","title":"TUI testing infrastructure with botty","description":"Set up visual/integration testing for the TUI using botty instead of tmux.\n\nbotty is a PTY daemon that can:\n- Spawn processes in headless PTYs\n- Send keystrokes \n- Capture screen snapshots\n- Ideal for deterministic TUI testing\n\nApproach:\n1. botty spawn -- crit tui <review>\n2. botty send <id> 'j' (navigate down)\n3. botty snapshot <id> | assert contains expected content\n4. botty kill <id>\n\nThis replaces ad-hoc tmux scripting with a proper test harness.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-26T21:13:11.793445219Z","created_by":"bob","updated_at":"2026-01-28T20:39:00.254853801Z","closed_at":"2026-01-28T20:39:00.254835667Z","close_reason":"Superseded by dedicated crit-ui project","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3h7","title":"Design SQLite schema","description":"Design tables for reviews, threads, comments. Include indexes for common queries (unresolved threads by file, open reviews by author). Schema should be rebuildable from event log.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-25T04:04:05.313159862Z","created_by":"bob","updated_at":"2026-01-25T13:42:04.823799624Z","closed_at":"2026-01-25T13:42:04.823780508Z","close_reason":"Schema designed in notes/sqlite-schema.sql","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3h7","depends_on_id":"bd-26n","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-3ho","title":"Add content hash or line count verification to sync_state","description":"Design issue: sync_state tracks last_line_number but has no way to detect when events.jsonl has been modified externally (truncated, rolled back by jj, or corrupted). The events_file_hash column exists in the schema but is never populated.\n\nIf the empty-line hypothesis from bd-2t5 is confirmed, fix by:\n1. Populate events_file_hash with a hash of events.jsonl content on each sync\n2. On next sync, compare hash — if different and last_line > file lines, force full rebuild\n3. Alternative: switch from line-count tracking to byte-offset tracking\n\nIf the empty-line hypothesis is NOT confirmed, this is still valuable as a defensive measure. The R4 eval proved that silent index staleness is hard to diagnose.\n\nSchema already has the column:\n  CREATE TABLE sync_state (\n    id INTEGER PRIMARY KEY CHECK (id = 1),\n    last_line_number INTEGER NOT NULL DEFAULT 0,\n    last_sync_ts TEXT,\n    events_file_hash TEXT  -- UNUSED, populate this\n  );","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-31T20:51:48.698228955Z","created_by":"bob","updated_at":"2026-01-31T21:09:33.393410034Z","closed_at":"2026-01-31T21:09:33.393370880Z","close_reason":"Superseded: content hash not needed — sync offset drift is self-correcting and never causes data loss.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3ho","depends_on_id":"bd-2t5","type":"blocks","created_at":"2026-01-31T20:51:52.838045734Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-3is","title":"Adopt terseid for ID generation","description":"Replace UUID-based ID generation in src/events/ids.rs with the terseid crate. Use IdGenerator with prefixes cr (reviews), th (threads). Drop the uuid dependency. Adopt adaptive-length hashing and collision avoidance.\n\nLibrary: https://github.com/bobisme/terseid (tagged v0.1.0)\nAPI reference: ~/src/terseid/spec.md\n\nChanges needed:\n- Cargo.toml: Add terseid = \"0.1.0\" dependency, remove uuid\n- src/events/ids.rs: Replace UUID calls with IdGenerator\n- Tests: Update ID format expectations (UUID → terseid format)","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-30T16:44:51.872391732Z","created_by":"bob","updated_at":"2026-02-03T22:33:18.764335136Z","closed_at":"2026-02-03T22:33:18.764307013Z","close_reason":"Completed: adopted terseid for ID generation","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":9,"issue_id":"bd-3is","author":"botcrit-dev","text":"Started in workspace mystic-viper (/home/bob/src/botcrit/.workspaces/mystic-viper)","created_at":"2026-02-03T22:22:29Z"}]}
{"id":"bd-3k4","title":"Clarify comment vs comments add naming","description":"The commands `crit comment` (creates thread) and `crit comments add` (adds to thread) are confusingly similar. Agents may accidentally create new threads when intending to reply.\n\nSuggestion: Consider `crit thread comment <thread_id>` or similar to make the distinction clearer.","status":"closed","priority":4,"issue_type":"feature","created_at":"2026-01-28T00:05:54.347595479Z","created_by":"bob","updated_at":"2026-01-28T20:06:19.525181434Z","closed_at":"2026-01-28T20:06:19.525144825Z","close_reason":"Added top-level 'crit reply <thread_id> <message>' command as clear counterpart to 'crit comment'. Updated 'crit comment' help to reference 'reply'. Existing 'crit comments add' still works.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3k9","title":"Suggest project-based agent name in agents show/init","description":"The agents show/init output should suggest an agent name based on the project directory: <pwd basedir>-dev (e.g. botcrit-dev). Check env first to avoid overriding an already-set identity.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T20:18:45.928188416Z","created_by":"bob","updated_at":"2026-01-28T20:20:37.979288154Z","closed_at":"2026-01-28T20:20:37.979273046Z","close_reason":"Implemented: renamed --author to --agent (with --author alias), updated agents show/init to emphasize --agent flag and suggest project-based name (e.g. botcrit-dev)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3m0","title":"crit diff shows only .crit/events.jsonl, not actual code changes","description":"When running 'crit diff' from a different workspace than where the review was created, it diffs against the current workspace's @ instead of the review's change.\n\nRoot cause: crit diff uses jj.get_current_commit() which gets @ from current workspace, not the review's jj_change_id.\n\nFix: Should resolve review.jj_change_id to get target commit, similar to how TUI does it:\n- For open reviews: resolve jj_change_id to current commit\n- For merged reviews: use final_commit\n\nThis is the same pattern used in review_detail.rs lines 87-91.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-26T20:16:12.055339989Z","created_by":"bob","updated_at":"2026-01-26T20:54:51.996937454Z","closed_at":"2026-01-26T20:54:51.996910935Z","close_reason":"Fixed: crit diff now resolves review's jj_change_id to get target commit instead of using workspace @","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3n2","title":"crit status and diff commands","description":"Implement crit status (summary view with drift detection) and crit diff (structured diff output). Support --unresolved-only filter.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T04:04:45.935084149Z","created_by":"bob","updated_at":"2026-01-25T16:57:19.370413470Z","closed_at":"2026-01-25T16:57:19.370391358Z","close_reason":"Implemented status command with drift detection and diff command with thread annotations","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3n2","depends_on_id":"bd-168","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3n2","depends_on_id":"bd-21c","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3n2","depends_on_id":"bd-28d","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3n2","depends_on_id":"bd-2sw","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3n2","depends_on_id":"bd-hk6","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-3oi","title":"TUI inline comments should be truly inline","description":"Comments currently appear after the entire diff. They should be inserted at the relevant line numbers within the diff.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-25T22:43:15.513260959Z","created_by":"bob","updated_at":"2026-01-28T20:39:05.211274758Z","closed_at":"2026-01-28T20:39:05.211246685Z","close_reason":"Superseded by dedicated crit-ui project","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3oi","depends_on_id":"bd-wsn","type":"blocks","created_at":"2026-01-26T21:13:24.947512197Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-3q7","title":"JJ Adapter","description":"Integration with Jujutsu for change tracking and drift detection","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-25T04:04:15.812406650Z","created_by":"bob","updated_at":"2026-01-25T13:42:08.517224165Z","closed_at":"2026-01-25T13:42:08.517205760Z","close_reason":"JJ Adapter epic - research complete","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3rv","title":"Add data version detection and enforcement","description":"Detect data format version and fail gracefully if migration needed.\n\n## Version file\n.crit/version contains a single line: \"1\" or \"2\"\n- Missing file + events.jsonl exists = version 1\n- Missing file + no events.jsonl = new repo, use version 2\n- File contains \"2\" = new format\n\n## Enforcement\nEvery crit command (except migrate, doctor, init) should:\n1. Check version\n2. If v1 detected, fail with clear message:\n   \"This repository uses crit data format v1. Run 'crit migrate' to upgrade to v2.\"\n3. If v2 or new repo, proceed normally\n\n## Implementation\n- Add version check to main.rs or common command setup\n- crit init: creates version file with \"2\"\n- crit migrate: upgrades version file from 1 to 2\n- crit doctor: reports version, suggests migration if v1\n\n## Future-proofing\nVersion file allows future format changes with clear upgrade path.\n\n## Testing\n- New repo gets version 2\n- Old repo without version file detected as v1\n- v1 repo blocks commands with helpful message\n- After migration, commands work","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-04T15:39:00.352879135Z","created_by":"bob","updated_at":"2026-02-04T17:19:31.439300060Z","closed_at":"2026-02-04T17:19:31.439259384Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":17,"issue_id":"bd-3rv","author":"Bob","text":"Implemented: version detection module with detect_version(), require_v2(), write_version_file(). Full test coverage.","created_at":"2026-02-04T15:47:46Z"}]}
{"id":"bd-3s1","title":"Add --path flag to all crit commands","description":"Allow users to run crit commands from any directory by specifying --path to the repo.\n\n**Current behavior:**\n- crit commands must be run from within the repo directory\n- Uses current working directory to find .crit/\n\n**Desired behavior:**\n- Accept --path flag on all commands\n- Intelligently find repo root from provided path:\n  - If path points to repo root: use it\n  - If path points to .crit dir: use parent\n  - If path points to subdirectory: walk up to find .crit/\n  - Bail with helpful error if no .crit found\n\n**Acceptance Criteria:**\n- Global --path flag (applies to all commands)\n- Finds .crit directory even when path is subdir\n- Works with absolute and relative paths\n- Error message shows searched paths if .crit not found\n- Examples:\n  - crit --path ~/projects/myrepo reviews list\n  - crit --path ~/projects/myrepo/src reviews list  # finds ~/projects/myrepo/.crit\n  - crit --path ~/projects/myrepo/.crit reviews list  # uses ~/projects/myrepo\n\n**Implementation notes:**\n- Add to top-level CLI struct (global flag)\n- Create repo_root_from_path() helper\n- Update all DB/JjRepo initialization to use resolved path\n- Consider --cwd alias for familiarity","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-01T21:37:11.095767346Z","created_by":"bob","updated_at":"2026-02-01T22:03:42.662430673Z","closed_at":"2026-02-01T22:03:42.662403492Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3sa","title":"crit comments subcommands","description":"Implement comments add, list. Support --request-id for idempotency and --expected-hash for optimistic locking.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T04:04:44.578498880Z","created_by":"bob","updated_at":"2026-01-25T16:55:18.099878538Z","closed_at":"2026-01-25T16:55:18.099856146Z","close_reason":"Implemented comments add/list with request_id and expected_hash support","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3sa","depends_on_id":"bd-168","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3sa","depends_on_id":"bd-21c","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3sa","depends_on_id":"bd-2sw","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3sa","depends_on_id":"bd-hk6","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-3tl","title":"Replace emoji with unicode/nerdfont glyphs","description":"Replace speech bubble emoji with unicode chars or nerdfont glyphs for consistency.","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-25T22:43:19.121248392Z","created_by":"bob","updated_at":"2026-01-25T22:44:28.431164295Z","closed_at":"2026-01-25T22:44:28.431135340Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3to","title":"Replace comment IDs with thread child IDs (th-xxx.N)","description":"Remove c-* comment IDs. Comments become child IDs of their parent thread: th-a7x3.1, th-a7x3.2, etc. Requires a per-thread counter or sequence to assign child numbers (e.g. column on threads table or COUNT query). Drop COMMENT_PREFIX, new_comment_id(), is_comment_id(). Update schema: comment_id changes from c-xxxx to th-xxxx.N format. Depends on terseid adoption since child IDs come from that library.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-30T16:44:51.956932613Z","created_by":"bob","updated_at":"2026-02-03T23:05:44.764458818Z","closed_at":"2026-02-03T23:05:44.764432188Z","close_reason":"Completed: Comment IDs now use thread child format (th-xxx.N). Review approved by botcrit-security.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3to","depends_on_id":"bd-3is","type":"blocks","created_at":"2026-01-30T16:44:56.064150232Z","created_by":"bob","metadata":"{}","thread_id":""}],"comments":[{"id":12,"issue_id":"bd-3to","author":"botcrit-dev","text":"Started in workspace swift-tiger (/home/bob/src/botcrit/.workspaces/swift-tiger)","created_at":"2026-02-03T22:53:01Z"}]}
{"id":"bd-3tp","title":"Bug: crit uses CWD instead of jj main repo root","description":"When running in a jj workspace, crit uses env::current_dir() as repo_root. This causes each workspace to have its own .crit/ directory with separate events.jsonl files, breaking multi-agent coordination.\n\nFix: Check if .jj/repo is a file (path to main repo) vs directory, and resolve to the canonical repo root.\n\nAffected: All commands that write to .crit/events.jsonl","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-25T23:10:41.389562657Z","created_by":"bob","updated_at":"2026-01-25T23:22:14.444124679Z","closed_at":"2026-01-25T23:22:14.444094112Z","close_reason":"Fixed: resolve_repo_root() now finds main repo for .crit/ while using workspace for jj","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3u1","title":"crit threads subcommands","description":"Implement threads create, list, show, resolve, reopen. Include --context flag for show. Implement batch resolve with --all flag.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T04:04:43.410459259Z","created_by":"bob","updated_at":"2026-01-25T16:53:38.331076378Z","closed_at":"2026-01-25T16:53:38.331055429Z","close_reason":"Implemented threads create/list/show/resolve/reopen with context extraction and batch resolve","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3u1","depends_on_id":"bd-168","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3u1","depends_on_id":"bd-21c","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3u1","depends_on_id":"bd-28d","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3u1","depends_on_id":"bd-2fq","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3u1","depends_on_id":"bd-2sw","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-3u1","depends_on_id":"bd-hk6","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-3u7","title":"Re-evaluate events.jsonl architecture for multi-agent workflows","description":"## Problem\n\nThe current single `events.jsonl` file is causing data loss in multi-agent workflows:\n\n1. **Concurrent write corruption**: Multiple agents in different jj workspaces all write to the same `.crit/events.jsonl`. Racing appends cause truncation.\n2. **Merge conflicts**: Even without races, merging workspaces that both touched events.jsonl creates conflicts.\n3. **maw auto-resolve makes it worse**: If `.crit/**` is in `auto_resolve_from_main`, maw runs `jj restore --from main` which discards ALL workspace events in favor of stale main version.\n\nThe current \"fix\" (bd-2m6) only mitigates data loss by backing up orphaned reviews — it doesn't prevent the corruption.\n\n## Root Cause\n\ncrit writes to a shared singleton file regardless of workspace context. This violates jj workspace isolation — each workspace's changes should be independent until merge.\n\n## Proposed Solution: Event log per review\n\n```\n.crit/\n  reviews/\n    cr-abc123/\n      events.jsonl    # only events for this review\n    cr-def456/\n      events.jsonl\n  index.db            # projection rebuilt from all review events\n```\n\n### Why this design:\n\n1. **Preserves event sourcing** — full history, replayable, auditable per review\n2. **Natural isolation** — agent on review X only touches `cr-X/events.jsonl`\n3. **Merge-friendly** — concurrent reviews = different files = no conflicts\n4. **Workspace-compatible** — isolation until merge, then trivial to combine\n5. **Scales** — no unbounded single file, natural sharding\n\n### Alternative considered: One JSON file per review (no events)\n\nSimpler but loses event history. Given crit's review workflow (comments, votes, status changes), event history is valuable for audit and debugging.\n\n## Migration path\n\n1. Add new per-review directory structure\n2. Migrate existing events.jsonl → split by review_id\n3. Update all read/write paths\n4. Rebuild projection from new structure\n5. Eventually remove legacy events.jsonl support\n\n## Related\n\n- maw bd-1cl: blocked waiting on this fix\n- crit bd-2m6: partial mitigation (orphan backup) already merged\n- Same pattern may apply to beads issues.jsonl\n\n## Context\n\nFrom discussion with bob analyzing the fierce-bear/frost-tower merge incident where reviews were lost. The fundamental issue is architectural: unit of isolation (review) should match unit of storage (file).","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-02-04T15:19:35.875139812Z","created_by":"bob","updated_at":"2026-02-04T15:39:18.111839597Z","closed_at":"2026-02-04T15:39:18.111809450Z","close_reason":"Superseded by bd-37x epic and sub-tasks","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3un","title":"Add --all-workspaces flag to inbox and reviews list","description":"## Problem\nAgents working in different jj workspaces can't see reviews from other workspaces, leading to duplicate reviews for the same work.\n\n## Solution\nAdd `--all-workspaces` flag to `crit inbox` and `crit reviews list` that:\n\n1. Enumerates all jj workspaces via `jj workspace list`\n2. Maps each review's `jj_change_id` to workspaces by matching against workspace working copy change IDs\n3. Groups/annotates output by workspace with name and relative path\n\n## Output Format\n\nFor `reviews list --all-workspaces`:\n```\n=== default (.) ===\n  cr-abc · Fix bug by alice [open]\n  \n=== my-feature (.workspaces/my-feature) ===\n  cr-def · Add endpoint by bob [open]\n\n=== No active workspace ===\n  cr-ghi · Old refactor by charlie [merged]\n```\n\nFor `inbox --all-workspaces`: annotate each item with `[workspace-name]` since inbox has its own groupings.\n\n## Requirements\n- Must be in a jj repo (fail with helpful error if not)\n- ReviewSummary needs to include jj_change_id (currently only ReviewDetail has it)\n- Reuse existing `find_workspace_for_change()` or similar logic\n- Show relative path from repo root for non-default workspaces","status":"closed","priority":2,"issue_type":"feature","owner":"botcrit-dev","created_at":"2026-02-04T22:39:28.620964175Z","created_by":"botcrit-dev","updated_at":"2026-02-04T23:07:10.832722890Z","closed_at":"2026-02-04T23:07:10.832688966Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-3v7","title":"Update AGENTS.md with new comment workflow","description":"Update the crit instructions in AGENTS.md to show the new simplified workflow:\n  \nOld: threads create + comments add\nNew: crit comment (single command)","status":"closed","priority":2,"issue_type":"docs","created_at":"2026-01-26T20:18:57.917765165Z","created_by":"bob","updated_at":"2026-01-26T20:55:45.105791095Z","closed_at":"2026-01-26T20:55:45.105759676Z","close_reason":"Done: updated AGENTS.md instructions with new crit comment workflow","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-3v7","depends_on_id":"bd-2rz","type":"blocks","created_at":"2026-01-26T20:19:02.886687095Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-3vf","title":"Thread comments not visible in 'crit threads show' output","description":"When running 'crit threads show <thread-id>', the output shows the code context but not the actual comments on the thread.\n\nExpected: Should show thread title, code context, AND all comments\nActual: Shows thread ID, file location, and code context, but comments are missing or truncated\n\nThis makes it difficult to follow the review conversation without manually inspecting events.jsonl.\n\nReproduction:\n1. Create a review with threads that have multiple comments\n2. Run 'crit threads show <thread-id>'\n3. Observe that comments are not shown","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-26T20:16:20.993093645Z","created_by":"bob","updated_at":"2026-01-26T20:19:37.351537198Z","closed_at":"2026-01-26T20:19:37.351508294Z","close_reason":"Cannot reproduce - comments display correctly in threads show output","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-42j","title":"crit init command","description":"Implement crit init: create .crit/ directory, empty events.jsonl, verify jj repo exists. Handle already-initialized case.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-25T04:04:39.602352036Z","created_by":"bob","updated_at":"2026-01-25T13:42:14.008249207Z","closed_at":"2026-01-25T13:42:14.008231063Z","close_reason":"Implemented","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-42j","depends_on_id":"bd-124","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-42j","depends_on_id":"bd-21c","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-42j","depends_on_id":"bd-2sw","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-4mo","title":"crit init should add index.db to .gitignore","description":"index.db is a local cache and should not be tracked in git. crit init should create/update .crit/.gitignore to exclude it.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-25T21:58:43.317604121Z","created_by":"bob","updated_at":"2026-01-25T21:59:42.217037707Z","closed_at":"2026-01-25T21:59:42.216964089Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-4p2","title":"Add --current flag to threads show","description":"Show thread context at HEAD instead of original commit. Allow agents to see how code has changed since the thread was created.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-25T17:33:18.190111325Z","created_by":"bob","updated_at":"2026-01-25T17:34:32.137969181Z","closed_at":"2026-01-25T17:34:32.137941670Z","close_reason":"Added --current flag to threads show command","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-50e","title":"Write events to workspace crit dir, not forced main","description":"Currently all event writes go to crit_root (main repo's .crit/).\nChange to write to current workspace's .crit/ so changes are isolated until merge.\n\n## Current behavior\n- crit_root always resolves to main repo (follows .jj/repo pointer)\n- Events written to main repo even when in workspace\n- This causes the merge conflicts we're trying to fix\n\n## New behavior  \n- Each workspace has its own .crit/reviews/ for reviews created there\n- On merge, per-review directories combine naturally (different dirs)\n- Only conflict if same review touched in multiple workspaces\n\n## Changes\n- src/jj/mod.rs: resolve_crit_root should return workspace-local path\n- OR: Add workspace_crit_root separate from main crit_root\n- Ensure index.db is still workspace-local (already gitignored)\n\n## Testing\n- Create review in workspace A, verify in .crit/reviews/\n- Create different review in workspace B\n- Merge workspaces, verify both reviews present\n- Same review in both workspaces should conflict (expected)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-02-04T15:38:43.946678559Z","created_by":"bob","updated_at":"2026-02-04T17:24:03.460677287Z","closed_at":"2026-02-04T17:24:03.460648804Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-72n","title":"TUI watch mode","description":"Implement live updates: watch events.jsonl for changes, refresh UI when new events appended. Use notify crate for file watching.","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-25T04:05:07.199644198Z","created_by":"bob","updated_at":"2026-01-28T20:39:00.266768209Z","closed_at":"2026-01-28T20:39:00.266750285Z","close_reason":"Superseded by dedicated crit-ui project","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-72n","depends_on_id":"bd-25a","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-72n","depends_on_id":"bd-2rx","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-94p","title":"Rename --author flag to --agent for botbus consistency","description":"The --author global flag should be renamed to --agent to be consistent with botbus conventions. Keep --author as a hidden alias for backwards compatibility.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T20:18:44.831225040Z","created_by":"bob","updated_at":"2026-01-28T20:20:37.969301163Z","closed_at":"2026-01-28T20:20:37.969272870Z","close_reason":"Implemented: renamed --author to --agent (with --author alias), updated agents show/init to emphasize --agent flag and suggest project-based name (e.g. botcrit-dev)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-c92","title":"Rename crit merge to mark-merged or reviews set-status","description":"User feedback: 'crit merge' sounds like it's doing more than it does. Options:\n1. Rename to 'crit mark-merged' (clearer what it actually does)\n2. Change to 'crit reviews set-status <review> <status>' (consistent with other review commands)\n\nAcceptance criteria:\n- [ ] Decide on naming approach\n- [ ] Update command name/structure\n- [ ] Update help text\n- [ ] Update any documentation references","status":"closed","priority":2,"issue_type":"task","owner":"botcrit-dev","created_at":"2026-02-04T22:26:19.215740740Z","created_by":"botcrit-dev","updated_at":"2026-02-04T22:53:05.007224703Z","closed_at":"2026-02-04T22:53:05.007188104Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":21,"issue_id":"bd-c92","author":"botcrit-dev","text":"Started in workspace radiant-reef (/home/bob/src/botcrit/.workspaces/radiant-reef)","created_at":"2026-02-04T22:31:09Z"},{"id":23,"issue_id":"bd-c92","author":"botcrit-dev","text":"Review cr-1kmd created and requested from @botcrit-security","created_at":"2026-02-04T22:37:55Z"}]}
{"id":"bd-d28","title":"Add --self-approve flag to reviews merge","description":"Currently merging a review requires two steps:\n\n```bash\ncrit reviews approve cr-xxx\ncrit reviews merge cr-xxx\n```\n\nFor single-reviewer workflows (self-review, solo projects), add a convenience flag:\n\n```bash\ncrit reviews merge cr-xxx --self-approve\n```\n\nThis approves and merges in one step. The two-step flow makes sense for team reviews but adds friction for personal use.","status":"closed","priority":4,"issue_type":"feature","created_at":"2026-01-27T19:16:58.362915880Z","created_by":"bob","updated_at":"2026-01-27T19:32:42.458434814Z","closed_at":"2026-01-27T19:32:42.458364152Z","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-fmo","title":"TUI shows .crit files in diff (jj tracking issue)","description":"Review detail shows .crit/events.jsonl and .crit/index.db even though they're not part of the review. Need to investigate jj change tracking assumptions.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-25T22:43:11.621381978Z","created_by":"bob","updated_at":"2026-01-25T22:44:13.278766755Z","closed_at":"2026-01-25T22:44:13.278748541Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-h7m","title":"Require BOTBUS_AGENT or CRIT_AGENT for identity, add --user flag","description":"Currently agent identity falls through to $USER when no env var is set. This causes agent work to be attributed to the human.\n\nChange:\n1. Require BOTBUS_AGENT or CRIT_AGENT to be set (error if missing)\n2. Add --user flag to explicitly use $USER identity (for human usage)\n3. Keep --author flag for arbitrary identity override","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-27T23:47:14.219314652Z","created_by":"bob","updated_at":"2026-01-27T23:53:22.359066321Z","closed_at":"2026-01-27T23:53:22.359030113Z","close_reason":"Implemented: require CRIT_AGENT or BOTBUS_AGENT, add --user flag for human identity","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-ha3","title":"Bump version to 0.2.0 for comment UX change","description":"Update Cargo.toml version to 0.2.0 to reflect the new comment workflow","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-26T20:18:57.728849379Z","created_by":"bob","updated_at":"2026-01-26T20:55:44.908432466Z","closed_at":"2026-01-26T20:55:44.908414201Z","close_reason":"Done: version bumped to 0.2.0","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-ha3","depends_on_id":"bd-13u","type":"blocks","created_at":"2026-01-26T20:19:02.686260482Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-hk6","title":"TOON output formatter","description":"Implement TOON encoding for CLI output. Support nested objects (YAML-style) and tabular arrays. Include --json flag to switch to JSON output.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-25T04:04:41.233971894Z","created_by":"bob","updated_at":"2026-01-25T13:54:35.135504770Z","closed_at":"2026-01-25T13:54:35.135480645Z","close_reason":"Implemented TOON and JSON formatters with tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-hk6","depends_on_id":"bd-12q","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""},{"issue_id":"bd-hk6","depends_on_id":"bd-2sw","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-ium","title":"Add --as flag for agent identity","description":"Every crit command currently requires `export BOTBUS_AGENT=... &&` prefix. Add a `--as <agent>` flag to reduce boilerplate:\n\n```bash\ncrit --as security-reviewer comments add th-3uur \"...\"\n```\n\nAlternatively, a session-scoped config:\n```bash\ncrit config set agent security-reviewer\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-28T00:05:54.017689674Z","created_by":"bob","updated_at":"2026-01-28T00:14:06.191807236Z","closed_at":"2026-01-28T00:14:06.191777971Z","close_reason":"Already implemented: --author flag does this. Example: crit --author security-reviewer comment ...","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-jc0","title":"Core crate (botcrit_core)","description":"Foundation crate with event types, append-only log, and agent identity resolution","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-25T04:03:45.574930417Z","created_by":"bob","updated_at":"2026-01-25T13:41:56.168953460Z","closed_at":"2026-01-25T13:41:56.168926209Z","close_reason":"Core crate complete: events, log, identity, IDs all implemented","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-knb","title":"TUI diff shows wrong files (working copy instead of review)","description":"ReviewDetailView compares initial_commit to @ (working copy) instead of the review's actual target commit. Should use jj_change_id to resolve current commit for that change.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-25T21:58:46.860488752Z","created_by":"bob","updated_at":"2026-01-25T22:00:54.429638566Z","closed_at":"2026-01-25T22:00:54.429615573Z","close_reason":"done","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-l4z","title":"Add --reviewer singular alias","description":"The 'reviews request' command requires --reviewers (plural) which is awkward when adding a single reviewer. Add --reviewer as an alias for ergonomics:\n  crit reviews request cr-xxx --reviewer bob","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-25T18:19:58.025356168Z","created_by":"bob","updated_at":"2026-01-25T19:46:33.536840101Z","closed_at":"2026-01-25T19:46:33.536808812Z","close_reason":"Implemented: --description with --desc alias, --message/--msg for comments, --reviewer alias for reviewers","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-o3f","title":"Auto-approve review when LGTM vote received (unless blocked by others)","description":"When a reviewer votes LGTM, automatically approve the review unless there are blocking votes from OTHER reviewers.\n\nLogic:\n- After recording a ReviewerVoted(LGTM) event, check for blocking votes\n- Query: SELECT COUNT(*) FROM reviewer_votes WHERE review_id=? AND vote='block' AND reviewer != ?\n- If count = 0 (no blocks from others), emit ReviewApproved event immediately\n- If count > 0 (blocked by someone else), do NOT auto-approve\n\nThis fixes the UX issue where:\n1. Reviewer votes LGTM ✓\n2. Author had to manually run 'crit reviews approve' (confusing!)\n3. Then merge\n\nAfter this change:\n1. Reviewer votes LGTM ✓\n2. Review automatically approved (if not blocked) ✓\n3. Author can merge directly\n\nChanges needed:\n- cli/commands/reviews.rs: Update run_vote() to check for blocks after LGTM\n- Add auto-approval logic after appending ReviewerVoted event\n- Add tests for:\n  * LGTM with no other votes → auto-approve\n  * LGTM with another LGTM → still approved (idempotent)\n  * LGTM with block from different reviewer → do NOT auto-approve\n  * Block with existing LGTM → review stays open (no auto-approve)\n\nEdge case: What if someone changes their vote from block to lgtm? Handle this by checking blocks AFTER the vote is recorded.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-02-03T21:25:51.808894875Z","created_by":"bob","updated_at":"2026-02-03T22:03:21.378905961Z","closed_at":"2026-02-03T22:03:21.378887857Z","close_reason":"Completed. Auto-approve on LGTM implemented and reviewed.","source_repo":".","compaction_level":0,"original_size":0,"comments":[{"id":6,"issue_id":"bd-o3f","author":"botcrit-dev","text":"Started in workspace electric-tiger (/home/bob/src/botcrit/.workspaces/electric-tiger)","created_at":"2026-02-03T21:54:20Z"}]}
{"id":"bd-o9a","title":"Design: TUI layout and navigation","description":"Design the TUI: review list view, thread list view, thread detail with code context, comment composition. Plan keyboard shortcuts and navigation flow.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-25T04:05:04.176938649Z","created_by":"bob","updated_at":"2026-01-25T22:53:56.182357740Z","closed_at":"2026-01-25T22:53:56.182339696Z","close_reason":"TUI layout complete: review list + detail view with file panel, diff area, and vim-style navigation","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-o9a","depends_on_id":"bd-25a","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-oum","title":"Design: move events.jsonl out of jj-tracked tree","description":"## Context\n\nbd-1s1 root cause: events.jsonl is tracked by jj, index.db is gitignored. When jj restores the working copy (squash, rebase, workspace merge), events.jsonl reverts to an older version while index.db retains a stale sync cursor. Fixed with truncation detection (rebuild on detect), but the architectural issue remains.\n\n## The Problem\n\nevents.jsonl is mutable append-only runtime state stored in a version-controlled tree. This is fundamentally wrong — jj treats it as source code and overwrites it during working copy updates. The truncation fix is a band-aid: it detects same-or-shorter file replacement but misses same-length content changes (the unused events_file_hash column in sync_state was designed for this).\n\n## Design Questions\n\n1. **Should crit stop being repo-root-only?** Currently resolve_repo_root() always resolves to the main repo. All workspaces share one .crit/. This works for reads but is fragile for writes (the bug we just fixed).\n\n2. **Should reviews be creatable from workspaces?** Currently yes — crit_root is main repo, workspace_root is cwd. The separation works but events.jsonl writes go to the main repo's working copy, which may be stale relative to the workspace.\n\n3. **Where should events.jsonl live?** Options:\n   - **A) .jj/crit/** — inside jj's internal dir, shared across workspaces (jj won't track it), but we're squatting in jj's namespace\n   - **B) ~/.local/share/crit/<repo-hash>/** — fully external, shared via filesystem, survives any jj operation, but divorced from the repo\n   - **C) Keep in .crit/ but gitignore it** — breaks cross-workspace sharing (each workspace gets its own copy, reviews invisible to other workspaces)\n   - **D) Keep current architecture + strengthen detection** — add content hash to sync_state (the events_file_hash column already exists), detect ANY content change not just truncation. Accept rebuilds as cost of jj integration.\n\n## Recommendation\n\nOption D is lowest risk and closes the remaining gap. Option B is the proper long-term fix but is a bigger change. Options A and C have dealbreaker trade-offs.\n\n## Suggested Sub-beads (if pursuing)\n\n- Add content hash to sync_state (populate events_file_hash column) — closes same-length replacement gap\n- Add stderr warning when rebuild is triggered — observability\n- Evaluate option B (external storage) for v2 architecture\n\n## Related\n\n- bd-1s1: original bug (closed, fixed with truncation detection)\n- bd-2uy, bd-2t5, bd-3ho: investigation beads (closed)\n- src/projection/mod.rs: sync_from_log, rebuild_projection\n- src/log/mod.rs: total_lines() method\n- sync_state schema: events_file_hash column (unused)","status":"closed","priority":0,"issue_type":"feature","created_at":"2026-01-31T21:23:42.072708069Z","created_by":"bob","updated_at":"2026-01-31T21:33:37.339988324Z","closed_at":"2026-01-31T21:33:37.339956825Z","close_reason":"Implemented Option D: content hash detection. Populated the existing events_file_hash column in sync_state with a prefix hash (SipHash of lines 0..last_sync_line). sync_from_log now detects same-length file replacement via hash mismatch and triggers rebuild. Added stderr warnings on rebuild. Hash backfills automatically on no-op sync for pre-existing databases.","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-reo","title":"Update agents show/init text to emphasize --agent flag over env vars","description":"The crit agent instructions (agents show/init) should primarily show the --agent flag for identity since env vars don't persist well in Claude Code. Still mention CRIT_AGENT/BOTBUS_AGENT env vars as an alternative.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-28T20:18:45.338600430Z","created_by":"bob","updated_at":"2026-01-28T20:20:37.976185297Z","closed_at":"2026-01-28T20:20:37.976168887Z","close_reason":"Implemented: renamed --author to --agent (with --author alias), updated agents show/init to emphasize --agent flag and suggest project-based name (e.g. botcrit-dev)","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-szr","title":"Better empty state messages","description":"Currently shows '[0]:' when no results match filters. Instead show helpful messages like:\n- 'No reviews match the filters'\n- 'No open threads'\n- 'No comments yet'\nContext-aware empty states improve UX.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-25T18:19:56.278750864Z","created_by":"bob","updated_at":"2026-01-25T19:48:26.447742041Z","closed_at":"2026-01-25T19:48:26.447707095Z","close_reason":"Implemented context-aware empty state messages for all list commands","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-vm0","title":"Feature: crit notify command for botbus integration","description":"Add a 'crit notify' command that integrates with botbus to send notifications:\n\n- crit notify pending: Send messages to all reviewers about their pending reviews\n- crit notify update <review_id>: Notify author/reviewers about an update\n- crit notify resolved <thread_id>: Notify thread participants\n\nThis bridges the gap between crit's data model and real-time agent coordination.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-25T23:21:47.106947635Z","created_by":"bob","updated_at":"2026-01-26T21:13:03.318529878Z","closed_at":"2026-01-26T21:13:03.318498078Z","close_reason":"Unnecessary - agents can use botbus directly","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-w6q","title":"Define Event enum and serialization","description":"Create the Event enum with all variants (ReviewCreated, ThreadCreated, CommentAdded, etc). Implement serde Serialize/Deserialize with JSON Lines format. Include common envelope fields (ts, author, event type).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-25T04:03:49.987185574Z","created_by":"bob","updated_at":"2026-01-25T13:42:00.525417705Z","closed_at":"2026-01-25T13:42:00.525399330Z","close_reason":"Implemented with tests","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-w6q","depends_on_id":"bd-jc0","type":"blocks","created_at":"2026-01-25T17:33:18Z","created_by":"import","metadata":"{}","thread_id":""}]}
{"id":"bd-wsn","title":"TUI: diff view with inline comment indicators","description":"Render the diff with visual indicators showing where comments exist.\n\n- Show comment count badges at line numbers with threads\n- Highlight lines that have comments\n- Keybinding to jump to next/prev comment\n- Expandable inline comment display (press Enter on a commented line)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-26T21:13:16.925968043Z","created_by":"bob","updated_at":"2026-01-28T20:39:05.201311729Z","closed_at":"2026-01-28T20:39:05.201276653Z","close_reason":"Superseded by dedicated crit-ui project","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-wsn","depends_on_id":"bd-2rx","type":"blocks","created_at":"2026-01-26T21:13:24.310443789Z","created_by":"bob","metadata":"{}","thread_id":""}]}
{"id":"bd-x3i","title":"TUI: cache delta output to avoid re-rendering on every keypress","description":"The TUI spawns delta processes on every render cycle, causing severe lag with reviews that have multiple files.\n\nRoot cause: render_with_delta() is called from render_diff_content() on every frame.\n\nFix: Cache the rendered Text output in FileSection and only re-render when:\n- The view is first opened\n- Side-by-side mode is toggled\n- Terminal width changes","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-27T19:00:11.738512160Z","created_by":"bob","updated_at":"2026-01-27T19:01:40.651808684Z","closed_at":"2026-01-27T19:01:40.651618247Z","close_reason":"Added CachedRender to FileSection, delta output now cached per file","source_repo":".","compaction_level":0,"original_size":0}
{"id":"bd-y53","title":"Project README.md following docs-readme guidelines","description":"Create/rewrite the main project README.md following ~/src/ai-docs/design/docs-readme.md guidelines:\n- Identity: one-sentence description, for/not-for\n- Grounding: screenshot from demo project + 3-5 canonical commands\n- Status: beta, compatibility (jj required), security posture\n- Non-goals (not a GitHub PR replacement, no central server)\n- Mental model (event sourcing, CQRS, .crit/ storage, change IDs)\n- Quick start (crit init, create review, comment, approve, merge)\n- Usage and operations (identity, output formats, workspace support)\n- Agent hints\n- Include automated screenshots from images/","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-28T21:22:04.073213248Z","created_by":"bob","updated_at":"2026-01-28T22:30:47.829978399Z","closed_at":"2026-01-28T22:30:47.829961167Z","close_reason":"Created project README.md following docs-readme guidelines: identity, grounding screenshot, status, non-goals, mental model, quick start, usage, demo link, screenshots table, agent hints, references.","source_repo":".","compaction_level":0,"original_size":0,"dependencies":[{"issue_id":"bd-y53","depends_on_id":"bd-2a4","type":"blocks","created_at":"2026-01-28T21:22:11.593315209Z","created_by":"bob","metadata":"{}","thread_id":""}]}
